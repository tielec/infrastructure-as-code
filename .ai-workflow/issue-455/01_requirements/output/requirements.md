# 要件定義書 - Issue #455

## Issue情報

- **Issue番号**: #455
- **タイトル**: [jenkins] AI WorkflowジョブにAPIキーパラメータを追加
- **状態**: open
- **URL**: https://github.com/tielec/infrastructure-as-code/issues/455
- **作成日**: 2025-01-20

---

## 0. Planning Documentの確認

Planning Phase（`.ai-workflow/issue-455/00_planning/output/planning.md`）で策定された開発計画を確認しました：

### 実装戦略
- **EXTEND戦略**: 既存のDSLファイル5つに同一パターンでパラメータを追加
- **テスト戦略**: INTEGRATION_ONLY（シードジョブ実行による動作確認）
- **テストコード戦略**: CREATE_TEST（手動検証手順書を作成）

### 品質ゲート（Phase 1: 要件定義）
Planning Documentで定義された以下の品質ゲートを満たす必要があります：
- [ ] 各APIキーの用途が明確に記載されている
- [ ] パラメータの説明文が日本語で記載されている
- [ ] 受け入れ基準が具体的に定義されている
- [ ] パラメータのデフォルト値が決定されている

---

## 1. 概要

### 1.1 背景

AI Workflowシステムは、複数のAIプロバイダー（GitHub、OpenAI、Anthropic等）のAPIを利用してコード生成、レビュー、Issue管理等の自動化を行います。現在、これらのAPIキーは以下の方法で管理されています：

- Jenkins Credentials Storeに保存
- ジョブ実行時にJenkinsfileから自動取得
- ユーザーが直接指定する手段がない

しかし、以下の理由から、ユーザーがジョブパラメータとしてAPIキーを直接指定できる機能が必要になりました：

1. **柔軟性の向上**: 開発者やテスト時に個人のAPIキーを使用したい
2. **クォータ管理**: チームごとに異なるAPIキー（異なるクォータ）を使い分けたい
3. **セキュリティ**: Jenkins Credentials Storeへのアクセス権限がないユーザーでも、自分のAPIキーでジョブを実行できる
4. **コスト管理**: プロジェクトや部署ごとにAPIキーを分離し、コスト追跡を容易にする

### 1.2 目的

AI Workflowの全ジョブ（all_phases, preset, single_phase, rollback, auto_issue）に以下のAPIキー用パラメータを追加することで、ユーザーが実行時にAPIキーを柔軟に指定できるようにします：

- `GITHUB_TOKEN` - GitHub Personal Access Token
- `OPENAI_API_KEY` - OpenAI API キー
- `CODEX_API_KEY` - Codex API キー（OPENAI_API_KEYの代替）
- `CLAUDE_CODE_OAUTH_TOKEN` - Claude Code OAuth トークン
- `CLAUDE_CODE_API_KEY` - Claude Code API キー
- `ANTHROPIC_API_KEY` - Anthropic API キー

### 1.3 ビジネス価値・技術的価値

**ビジネス価値**:
- **コスト最適化**: チームごとのAPIキー分離により、コスト追跡とクォータ管理が容易
- **開発速度向上**: 開発者が自分のAPIキーで即座にテスト可能
- **セキュリティ強化**: Jenkins管理者のみがアクセスできるCredentials Storeに依存しない

**技術的価値**:
- **設計思想の一貫性**: 既存パラメータ（AWS認証情報）と同じパターンでAPI認証を統一管理
- **保守性向上**: パラメータをDSLファイルで集中管理（Jenkinsfileでの定義禁止ルールに準拠）
- **テスト容易性**: パラメータとして渡すことで、CI/CDパイプライン内でのテストが容易

---

## 2. 機能要件

### FR-1: パラメータの追加

**優先度**: 高

**説明**: 以下のAPIキー用パスワードパラメータを、AI Workflowの5つのDSLファイルに追加する。

#### 対象ファイル
1. `jenkins/jobs/dsl/ai-workflow/ai_workflow_all_phases_job.groovy`
2. `jenkins/jobs/dsl/ai-workflow/ai_workflow_preset_job.groovy`
3. `jenkins/jobs/dsl/ai-workflow/ai_workflow_single_phase_job.groovy`
4. `jenkins/jobs/dsl/ai-workflow/ai_workflow_rollback_job.groovy`
5. `jenkins/jobs/dsl/ai-workflow/ai_workflow_auto_issue_job.groovy`

#### 追加するパラメータ

| パラメータ名 | 型 | デフォルト値 | 用途 | 説明（日本語） |
|-------------|-----|------------|------|--------------|
| `GITHUB_TOKEN` | password | なし（空文字列） | GitHub API呼び出し | GitHub Personal Access Token（任意）<br>GitHub API呼び出しに使用されます |
| `OPENAI_API_KEY` | password | なし（空文字列） | Codex実行モード | OpenAI API キー（任意）<br>Codex実行モードで使用されます |
| `CODEX_API_KEY` | password | なし（空文字列） | Codex実行モード（代替） | Codex API キー（任意）<br>OPENAI_API_KEYの代替として使用可能 |
| `CLAUDE_CODE_OAUTH_TOKEN` | password | なし（空文字列） | Claude実行モード | Claude Code OAuth トークン（任意）<br>Claude実行モードで使用されます |
| `CLAUDE_CODE_API_KEY` | password | なし（空文字列） | Claude実行モード | Claude Code API キー（任意）<br>Claude実行モードで使用されます |
| `ANTHROPIC_API_KEY` | password | なし（空文字列） | Claude実行モード | Anthropic API キー（任意）<br>Claude実行モードで使用されます |

#### パラメータ定義方法
- **型**: `password` (Groovy DSLの`password()`メソッドを使用)
- **デフォルト値**: 空文字列（すべてのパラメータで任意入力）
- **説明文**: 日本語で記述、複数行対応（`.stripIndent().trim()`を使用）

### FR-2: パラメータ配置位置の統一

**優先度**: 高

**説明**: 新規追加するAPIキーパラメータは、既存のパラメータセクション構成に従い、以下の位置に配置する。

#### 既存のパラメータセクション構成
1. 基本設定（ISSUE_URL、BRANCH_NAME、AGENT_MODE等）
2. 実行オプション（DRY_RUN、SKIP_REVIEW等）
3. Git設定（GIT_COMMIT_USER_NAME、GIT_COMMIT_USER_EMAIL）
4. **AWS認証情報**（AWS_ACCESS_KEY_ID、AWS_SECRET_ACCESS_KEY、AWS_SESSION_TOKEN）← ここ
5. **【新規】APIキー設定** ← ここに追加
6. その他（COST_LIMIT_USD、LOG_LEVEL）

#### 配置位置の根拠
- AWS認証情報セクションと同様に「外部API認証」として論理的にグループ化
- 「その他」セクションの前に配置し、認証関連パラメータを集約
- 既存のコメントセクション形式（`// ========================================`）を踏襲

### FR-3: コメントセクションの追加

**優先度**: 中

**説明**: 新規パラメータセクションには、既存の形式に従ったコメントヘッダーを追加する。

```groovy
// ========================================
// APIキー設定
// ========================================
```

### FR-4: パラメータの型安全性

**優先度**: 高

**説明**: パスワードパラメータは、Jenkins UIでマスク表示され、ビルドログに平文で出力されないことを保証する。

- Groovy DSLの`password()`メソッドを使用
- ビルドログでパラメータ値がマスク（`****`）表示される
- 環境変数として他のステップに渡される際も、Jenkins Pipeline環境変数として安全に処理される

### FR-5: 各ジョブでの一貫性

**優先度**: 高

**説明**: 5つのDSLファイルすべてで、同一のパラメータ定義パターンを適用する。

- パラメータ名、説明文、配置位置がすべて同一
- コピー&ペーストではなく、テンプレート的に統一された実装

---

## 3. 非機能要件

### NFR-1: パフォーマンス要件

**測定基準**: シードジョブ実行時間が既存の実行時間から10%以上増加しないこと

- パラメータ6個の追加は、DSLスクリプト処理時間にほぼ影響を与えない
- Jenkins UIでのパラメータ表示時間も体感上変化なし（1秒未満）

### NFR-2: セキュリティ要件

**パスワードマスキング**:
- Jenkins UIのパラメータ入力欄で、入力値がマスク表示される
- ビルドログで、パラメータ値が`****`としてマスク表示される
- 環境変数として渡される際も、Jenkins Pipelineのセキュアな環境変数メカニズムを使用

**保存ポリシー**:
- `password()`メソッドは非保存型（non-stored）であり、ビルド完了後に値が破棄される
- Jenkinsのビルド履歴XMLファイルにも平文で保存されない

### NFR-3: 可用性・信頼性要件

**後方互換性**:
- 既存のJenkinsfileやパイプラインスクリプトに影響を与えない
- パラメータは任意入力（空欄可）のため、既存のワークフローに変更不要

**エラーハンドリング**:
- パラメータが空の場合、既存の動作（Credentials Storeから取得）にフォールバック
- 不正な値が入力された場合、実行時にわかりやすいエラーメッセージを表示

### NFR-4: 保守性・拡張性要件

**コーディング規約の遵守**:
- `jenkins/CONTRIBUTION.md`に記載されたパラメータ定義ルールに準拠
- パラメータは**必ずDSLファイルで定義**（Jenkinsfileでの定義は禁止）
- インデント、コメント形式、説明文の記述方法が既存コードと統一

**ドキュメント更新**:
- `jenkins/README.md`のパラメータ説明セクションを更新（必要に応じて）
- Issue #455に実装内容をコメント投稿

**拡張性**:
- 将来的にAPIキーが増えた場合、同じパターンで追加可能
- パラメータ名は環境変数名と一致させ、Jenkinsfile側での参照が容易

---

## 4. 制約事項

### 4.1 技術的制約

**Jenkins Job DSLの仕様**:
- パラメータは必ずDSLファイルで定義する必要がある（`jenkins/CONTRIBUTION.md`の絶対ルール）
- Jenkinsfileでのパラメータ定義は初回実行時にパラメータが認識されないため禁止

**Groovy DSL構文**:
- `password()`メソッドの引数は`(name, description)`の2つのみ
- 説明文は`'''.stripIndent().trim()`で複数行対応

**既存コードとの整合性**:
- AWS認証情報パラメータ（`AWS_SECRET_ACCESS_KEY`等）では`nonStoredPasswordParam()`を使用
- 新規パラメータでは`password()`を使用（統一性のため、より短い記述を推奨）

### 4.2 リソース制約

**時間制約**:
- 見積もり工数: 2〜3時間（Planning Documentより）
- フェーズ1（要件定義）: 0.5時間

**人員制約**:
- 開発者: 1名
- レビュー: AI Workflow Agent（クリティカルシンキングレビュー）

### 4.3 ポリシー制約

**セキュリティポリシー**:
- APIキーは平文でログに出力してはならない
- ビルド履歴XMLに保存してはならない
- Jenkins UIでマスク表示されなければならない

**コーディング規約**:
- `jenkins/CONTRIBUTION.md` - Jenkins開発ガイド
- `CLAUDE.md` - プロジェクト全体のガイドライン
- コミットメッセージ規約: `[jenkins] add: AI WorkflowジョブにAPIキーパラメータを追加`

---

## 5. 前提条件

### 5.1 システム環境

**Jenkins環境**:
- Jenkinsバージョン: 2.426.1以上
- Job DSL Plugin: インストール済み
- Pipeline Plugin: インストール済み

**プラグイン依存**:
- Job DSL Plugin（ジョブ定義）
- Pipeline Plugin（Jenkinsfile実行）
- Credentials Binding Plugin（パスワードパラメータのマスキング）

### 5.2 依存コンポーネント

**シードジョブ**:
- `Admin_Jobs/job-creator` - ジョブ定義を読み込んでジョブを生成
- 実行により、DSLファイルの変更が即座にJenkinsジョブに反映される

**設定ファイル**:
- `jenkins/jobs/pipeline/_seed/job-creator/job-config.yaml` - ジョブ定義（変更不要）
- `jenkins/jobs/pipeline/_seed/job-creator/folder-config.yaml` - フォルダ定義（変更不要）

### 5.3 外部システム連携

**AI Workflowエージェント**:
- Jenkinsfileは`https://github.com/tielec/ai-workflow-agent.git`から取得
- パラメータは環境変数として渡される
- エージェント側で`params.GITHUB_TOKEN`等としてアクセス可能

**APIプロバイダー**:
- GitHub API - `GITHUB_TOKEN`
- OpenAI API - `OPENAI_API_KEY`, `CODEX_API_KEY`
- Anthropic Claude API - `CLAUDE_CODE_OAUTH_TOKEN`, `CLAUDE_CODE_API_KEY`, `ANTHROPIC_API_KEY`

---

## 6. 受け入れ基準

各機能要件に対する具体的な受け入れ基準を、Given-When-Then形式で記述します。

### AC-1: パラメータがDSLファイルに追加されている

**Given**: 開発者がDSLファイルを開く
**When**: `ai_workflow_all_phases_job.groovy`のパラメータセクションを確認する
**Then**:
- 6つのパスワードパラメータ（`GITHUB_TOKEN`, `OPENAI_API_KEY`, `CODEX_API_KEY`, `CLAUDE_CODE_OAUTH_TOKEN`, `CLAUDE_CODE_API_KEY`, `ANTHROPIC_API_KEY`）が定義されている
- 各パラメータは`password()`メソッドで定義されている
- 説明文が日本語で記載されている
- 説明文は`.stripIndent().trim()`で整形されている

**適用対象**: 5つのDSLファイルすべて

### AC-2: パラメータがJenkins UIで表示される

**Given**: シードジョブ（`Admin_Jobs/job-creator`）が正常に実行されている
**When**: Jenkins UIで`AI_Workflow/infrastructure-as-code/01_All_Phases`ジョブを開く
**Then**:
- 「ビルドのパラメータ化」セクションにAPIキー設定パラメータが表示される
- 各パラメータの入力欄が「パスワード」タイプ（`*****`表示）である
- 説明文が日本語で正しく表示される
- パラメータの順序が「AWS認証情報」の後、「その他」の前である

### AC-3: パラメータ値がマスク表示される

**Given**: ジョブパラメータに`GITHUB_TOKEN=ghp_test123456`を入力
**When**: ジョブを実行してビルドログを確認する
**Then**:
- ビルドログでパラメータ値が`****`としてマスク表示される
- `ghp_test123456`が平文で表示されない
- Jenkins UIのパラメータ表示でも`****`としてマスク表示される

### AC-4: パラメータが環境変数として利用可能

**Given**: ジョブパラメータに`OPENAI_API_KEY=sk-test123`を入力
**When**: Jenkinsfileで`params.OPENAI_API_KEY`または`env.OPENAI_API_KEY`を参照する
**Then**:
- 値が正しく取得できる（`sk-test123`）
- 環境変数として子プロセスに渡される
- AI Workflowエージェントが環境変数として読み取れる

### AC-5: 5つのジョブすべてで一貫性がある

**Given**: シードジョブが実行され、5つのジョブが生成されている
**When**: 5つのジョブ（all_phases, preset, single_phase, rollback, auto_issue）のパラメータを確認する
**Then**:
- すべてのジョブで同じ6つのAPIキーパラメータが定義されている
- パラメータ名、説明文、順序がすべて同一である
- コメントセクション（`// ========================================`）の形式が統一されている

### AC-6: 既存のパラメータに影響がない

**Given**: 既存のパラメータ（`ISSUE_URL`, `DRY_RUN`, `AWS_ACCESS_KEY_ID`等）が定義されている
**When**: 新規パラメータを追加する
**Then**:
- 既存のパラメータ定義が変更されていない
- 既存のパラメータの順序が変更されていない（新規パラメータはAWSセクションと「その他」の間に挿入）
- 既存のJenkinsfileやパイプラインスクリプトが動作し続ける

### AC-7: シードジョブが正常に実行される

**Given**: DSLファイルに新規パラメータを追加済み
**When**: `Admin_Jobs/job-creator`シードジョブを実行する
**Then**:
- シードジョブが成功（SUCCESS）ステータスで完了する
- コンソール出力にエラーメッセージがない
- "Processing DSL script ai_workflow_all_phases_job.groovy"等のメッセージが表示される
- 5つのジョブすべてが更新される（"Updated items"にリストアップ）

### AC-8: 空パラメータでもジョブが実行可能

**Given**: すべてのAPIキーパラメータを空欄のままにする
**When**: ジョブを実行する
**Then**:
- ジョブが正常に開始される
- エラーが発生しない（Credentials Storeからのフォールバックまたは空値として処理される）
- ビルドログにパラメータ関連のエラーがない

---

## 7. スコープ外

本要件では、以下の項目は明確にスコープ外とします。

### 7.1 Jenkinsfile側の実装変更

- パラメータ値の検証ロジック（空チェック、フォーマット検証等）
- パラメータ値の環境変数への変換処理
- Credentials Storeからのフォールバック処理
- APIキーの優先順位制御（パラメータ vs Credentials Store）

**理由**: 本Issueはパラメータ定義の追加のみをスコープとし、実行ロジックの変更は含まない。Jenkinsfile側の実装は、AI Workflowエージェント側（別リポジトリ）で管理される。

### 7.2 パラメータ検証機能

- APIキーの形式検証（`ghp_`で始まるか、`sk-`で始まるか等）
- APIキーの有効性チェック（実際にAPIを呼び出して検証）
- APIキーのクォータ残量チェック

**理由**: DSLファイルではパラメータ定義のみを行い、検証ロジックは実行時（Jenkinsfile内）で行う設計思想に基づく。

### 7.3 既存パラメータの変更

- 既存のパラメータ（`AWS_SECRET_ACCESS_KEY`等）を`password()`から`nonStoredPasswordParam()`に変更
- 既存のパラメータの説明文の変更
- 既存のパラメータの順序変更

**理由**: 本Issueは新規パラメータ追加のみをスコープとし、既存コードの変更は最小限に留める。

### 7.4 ドキュメント以外の更新

- `jenkins/README.md`の詳細な更新（必要に応じて実施）
- Jenkins UIのヘルプテキスト追加
- パラメータ使用例のサンプルコード作成

**理由**: 最小限の実装に留め、必要に応じて別Issueで対応。

### 7.5 将来的な拡張候補

以下の機能は、将来的に検討する価値があるが、本Issueではスコープ外とします：

- **パラメータのグループ化**: Jenkins UIでパラメータをセクションごとに折りたたみ表示
- **デフォルト値の動的設定**: Credentials Storeから値を取得してデフォルト値として設定
- **パラメータの条件付き表示**: `AGENT_MODE`が`codex`の場合のみ`OPENAI_API_KEY`を表示
- **パラメータの暗号化保存**: ビルド履歴に暗号化して保存
- **パラメータのグローバル設定**: Jenkins全体のグローバル設定として定義

---

## 8. リスクと軽減策

Planning Documentで定義されたリスクを再確認し、要件定義の観点から追加の軽減策を記載します。

### リスク1: パラメータ名の誤り

**影響度**: 中
**確率**: 低
**軽減策**:
- Issue #455に記載された正確なパラメータ名を使用
- 実装前にパラメータ名リストをレビュー
- シードジョブ実行後、パラメータ名を目視確認
- **【要件定義での追加】**: パラメータ名は環境変数名と一致させる（`GITHUB_TOKEN`, `OPENAI_API_KEY`等）

### リスク2: パスワードパラメータの構文エラー

**影響度**: 中
**確率**: 低
**軽減策**:
- 既存のDSLファイルで使用されている`nonStoredPasswordParam()`の構文を参照
- 1つのファイルで実装・テスト後、他のファイルにコピー
- シードジョブのコンソール出力でエラー確認
- **【要件定義での追加】**: `password()`メソッドの引数は`(name, description)`の2つのみであることを明記

### リスク3: シードジョブ実行失敗

**影響度**: 中
**確率**: 低
**軽減策**:
- 実装前にGit管理下にあることを確認（ロールバック可能）
- シードジョブのコンソール出力を詳細に確認
- エラー発生時は即座にGit revertで復旧
- **【要件定義での追加】**: 受け入れ基準AC-7でシードジョブ実行成功を必須要件とする

### リスク4: 既存パラメータの配置ずれ

**影響度**: 低
**確率**: 低
**軽減策**:
- パラメータ追加位置を慎重に選定（AWSセクションの後）
- 既存のセクション構造を崩さないように注意
- Jenkins UI上でパラメータ順序を確認
- **【要件定義での追加】**: 受け入れ基準AC-6で既存パラメータへの影響がないことを検証

### リスク5: セキュリティリスク（パスワード平文表示）

**影響度**: 高
**確率**: 低
**軽減策**:
- `password()`メソッドを使用し、Jenkins標準のマスキング機能を活用
- 受け入れ基準AC-3でマスク表示を明確に検証
- ビルドログに平文が出力されないことを確認

### リスク6: 後方互換性の破壊

**影響度**: 中
**確率**: 極低
**軽減策**:
- パラメータは任意入力（空欄可）のため、既存ワークフローに影響なし
- 受け入れ基準AC-8で空パラメータでもジョブが実行可能であることを検証

---

## 9. 成功基準

本要件定義が成功したと判断する基準を明確に定義します。

### 9.1 機能要件の充足

- [ ] **FR-1**: 6つのAPIキーパラメータが5つのDSLファイルすべてに追加されている
- [ ] **FR-2**: パラメータ配置位置が統一されている（AWS認証情報セクションと「その他」の間）
- [ ] **FR-3**: コメントセクション（`// ========================================`）が追加されている
- [ ] **FR-4**: パラメータがJenkins UIでパスワードタイプとして表示され、マスキングされる
- [ ] **FR-5**: 5つのジョブすべてで同一のパラメータ定義パターンが適用されている

### 9.2 非機能要件の充足

- [ ] **NFR-1**: シードジョブ実行時間が既存の実行時間から10%以上増加していない
- [ ] **NFR-2**: パラメータ値がビルドログで`****`としてマスク表示される
- [ ] **NFR-3**: 既存のワークフローに影響を与えない（後方互換性）
- [ ] **NFR-4**: `jenkins/CONTRIBUTION.md`のコーディング規約に準拠している

### 9.3 受け入れ基準の達成

- [ ] **AC-1〜AC-8**: すべての受け入れ基準が満たされている
- [ ] **品質ゲート（Phase 1）**: Planning Documentで定義された4つの品質ゲートをすべてクリア

### 9.4 ドキュメント完成度

- [ ] 要件定義書が品質ゲート（Phase 1）をすべて満たしている
- [ ] クリティカルシンキングレビューでブロッカーが検出されない
- [ ] 各セクションが具体的かつ検証可能な形で記述されている

---

## 10. レビューチェックリスト

要件定義書のレビュー時に確認すべき項目を列挙します。

### 10.1 品質ゲート（Phase 1）の確認

- [ ] **各APIキーの用途が明確に記載されている**
  - FR-1の表でパラメータごとの用途を記載済み
  - セクション1.2でビジネス価値を説明済み

- [ ] **パラメータの説明文が日本語で記載されている**
  - FR-1の表で日本語説明文を記載済み
  - Groovy DSL実装例も示している

- [ ] **受け入れ基準が具体的に定義されている**
  - セクション6でGiven-When-Then形式で8つの受け入れ基準を定義済み
  - 各基準が検証可能（テスト可能）な形で記述されている

- [ ] **パラメータのデフォルト値が決定されている**
  - FR-1の表ですべてのパラメータのデフォルト値を「なし（空文字列）」と明記

### 10.2 機能要件の明確性

- [ ] 機能要件が具体的かつ測定可能である
- [ ] 機能要件の優先度が明確である
- [ ] 機能要件間の依存関係が明確である

### 10.3 受け入れ基準の検証可能性

- [ ] すべての受け入れ基準がGiven-When-Then形式で記述されている
- [ ] 各受け入れ基準がテスト可能である
- [ ] 成功条件・失敗条件が明確に識別可能である

### 10.4 スコープの明確性

- [ ] スコープ内の項目が明確に定義されている
- [ ] スコープ外の項目が明確に定義されている
- [ ] スコープ外の項目に将来的な拡張候補が含まれている

### 10.5 整合性の確認

- [ ] 機能要件と受け入れ基準が対応している
- [ ] 非機能要件と制約事項が矛盾していない
- [ ] Planning Documentとの整合性がある

### 10.6 論理的矛盾のチェック

- [ ] 要件間で矛盾がない
- [ ] 前提条件と制約事項が矛盾していない
- [ ] 成功基準とスコープが一致している

---

## 11. 次フェーズへの引き継ぎ事項

要件定義フェーズ完了後、設計フェーズ（Phase 2）に引き継ぐべき重要事項を記載します。

### 11.1 重要な決定事項

1. **パラメータタイプの選択**: `password()`メソッドを使用（`nonStoredPasswordParam()`ではない）
2. **配置位置**: AWS認証情報セクションと「その他」セクションの間
3. **デフォルト値**: すべて空文字列（任意入力）
4. **説明文の言語**: 日本語（既存コードとの統一）

### 11.2 技術的な制約

1. **パラメータ定義場所**: 必ずDSLファイル（Jenkinsfileでの定義禁止）
2. **Groovy DSL構文**: `password(name, description)`の2引数形式
3. **説明文整形**: `.stripIndent().trim()`を使用

### 11.3 設計フェーズで検討すべき事項

1. **パラメータ定義の実装パターン**: Planning Documentのセクション8で示されたパターンを適用
2. **コメントセクションの形式**: 既存の`// ========================================`形式を踏襲
3. **説明文の具体的な文言**: FR-1の表を参照

### 11.4 テストフェーズで検証すべき事項

1. **AC-1〜AC-8**: すべての受け入れ基準を順次検証
2. **シードジョブ実行**: エラーなく成功すること（AC-7）
3. **パスワードマスキング**: ビルドログで`****`表示されること（AC-3）

---

## 12. 付録

### 12.1 参照ドキュメント

- **Planning Document**: `.ai-workflow/issue-455/00_planning/output/planning.md`
- **CLAUDE.md**: プロジェクト全体のガイドライン
- **jenkins/CONTRIBUTION.md**: Jenkins開発ガイド（パラメータ定義ルール）
- **Issue #455**: https://github.com/tielec/infrastructure-as-code/issues/455

### 12.2 用語集

| 用語 | 説明 |
|------|------|
| DSLファイル | Job DSL Pluginで使用するGroovyスクリプトファイル |
| シードジョブ | DSLファイルを読み込んでJenkinsジョブを自動生成するジョブ |
| パスワードパラメータ | Jenkins UIでマスク表示される、セキュアなパラメータタイプ |
| Credentials Store | Jenkinsのクレデンシャル管理機能 |
| Planning Document | Issue #455の開発計画書（Phase 0で作成） |
| 品質ゲート | 次フェーズに進むための必須要件 |

### 12.3 パラメータ一覧（再掲）

| # | パラメータ名 | 用途 | プロバイダー |
|---|-------------|------|-------------|
| 1 | `GITHUB_TOKEN` | GitHub API呼び出し | GitHub |
| 2 | `OPENAI_API_KEY` | Codex実行モード | OpenAI |
| 3 | `CODEX_API_KEY` | Codex実行モード（代替） | OpenAI |
| 4 | `CLAUDE_CODE_OAUTH_TOKEN` | Claude実行モード | Anthropic |
| 5 | `CLAUDE_CODE_API_KEY` | Claude実行モード | Anthropic |
| 6 | `ANTHROPIC_API_KEY` | Claude実行モード | Anthropic |

---

## 13. 承認

### 13.1 品質ゲート確認

- [ ] 各APIキーの用途が明確に記載されている → **達成**（セクション2、FR-1）
- [ ] パラメータの説明文が日本語で記載されている → **達成**（FR-1の表）
- [ ] 受け入れ基準が具体的に定義されている → **達成**（セクション6、AC-1〜AC-8）
- [ ] パラメータのデフォルト値が決定されている → **達成**（FR-1：すべて空文字列）

### 13.2 レビュー結果

- **クリティカルシンキングレビュー**: 未実施（次ステップ）
- **ブロッカー**: なし（想定）
- **改善提案**: レビュー後に反映

### 13.3 次フェーズへの移行判断

- [ ] 品質ゲート（Phase 1）をすべてクリア
- [ ] レビューでブロッカーが検出されない
- [ ] すべての必須セクションが記載されている

**判断**: 要件定義フェーズ完了、設計フェーズ（Phase 2）へ移行可能

---

**文書作成日**: 2025-01-20
**作成者**: AI Workflow Agent
**バージョン**: 1.0
**ステータス**: レビュー待ち
