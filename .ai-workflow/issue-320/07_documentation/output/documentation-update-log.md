# ドキュメント更新ログ

**Issue**: #320
**フェーズ**: Phase 7 (documentation)
**実行日時**: 2025-10-12
**変更内容**: `--phase all` 機能の追加に伴うドキュメント更新

---

## 1. 調査対象ファイル

プロジェクト内の全 `.md` ファイルを調査しました（`.ai-workflow` ディレクトリは除外）。

### 調査したドキュメント一覧

| ファイルパス | 更新要否 | 理由 |
|------------|---------|------|
| `scripts/ai-workflow/README.md` | ✅ 更新 | ユーザー向けCLIコマンドのメイン利用ガイド。新機能の使用方法を追加する必要がある |
| `scripts/ai-workflow/ARCHITECTURE.md` | ❌ 更新不要 | アーキテクチャ構造は変更なし。既存パターンの組み合わせで実装 |
| `scripts/ai-workflow/TROUBLESHOOTING.md` | ❌ 更新不要 | 新機能特有のトラブルシューティング事例は未発生 |

---

## 2. 更新したファイル

### 2.1 `scripts/ai-workflow/README.md`

**更新理由:**
- ユーザーが `--phase all` 機能を使用するための情報が不足していた
- CLIコマンドのフェーズ名一覧に `all` が含まれていなかった
- 使用例が不足していた
- Docker環境での実行例が不足していた

**変更内容:**

#### (1) フェーズ名一覧の更新
**セクション**: `3. CLI コマンド` → `execute` コマンド → `--phase` オプション

**追加内容:**
```markdown
- `all`: **全フェーズ一括実行（Phase 1-8）** ← 新機能（v1.8.0）
```

**理由**: ユーザーが利用可能なフェーズ名として `all` を認識できるようにするため。

---

#### (2) 使用例の追加
**セクション**: `3. CLI コマンド` → `execute` コマンド → **例:** の末尾

**追加内容:**
```markdown
# 全フェーズを一括実行（Phase 1-8を順次自動実行）
python main.py execute --phase all --issue 304
```

**理由**: 新機能の基本的な使用方法を示すため。

---

#### (3) 機能特徴セクションの追加
**セクション**: `3. CLI コマンド` → `execute` コマンド → 使用例の直後

**追加内容:**
```markdown
**`--phase all` の特徴:**
- Phase 1（requirements）からPhase 8（report）まで順次自動実行
- 各フェーズ完了後、自動的に次フェーズに進行
- 途中でフェーズが失敗した場合、それ以降のフェーズは実行されず停止
- 実行サマリーで全フェーズの結果、総実行時間、総コストを表示
- Phase 0（planning）は含まれない（事前に個別実行を推奨）
```

**理由**: ユーザーが新機能の動作を正しく理解し、適切に使用できるようにするため。特に以下の重要な制約を明確にする必要があった:
- Phase 0が含まれないこと
- 失敗時の停止動作
- 実行サマリーの表示

---

#### (4) Docker環境での使用例の追加
**セクション**: `2. クイックスタート` → 新規セクション `### 4. 全フェーズ一括実行（オプション）`

**追加内容:**
```markdown
### 4. 全フェーズ一括実行（オプション）

全フェーズ（Phase 1-8）を一括で実行する場合:

```bash
# 全フェーズ（Phase 1-8）を一括実行
docker run --rm \
  -e CLAUDE_CODE_OAUTH_TOKEN="${CLAUDE_CODE_OAUTH_TOKEN}" \
  -e GITHUB_TOKEN="${GITHUB_TOKEN}" \
  -e GITHUB_REPOSITORY="${GITHUB_REPOSITORY}" \
  -e OPENAI_API_KEY="${OPENAI_API_KEY}" \
  -v "$(pwd):/workspace" \
  -w /workspace/scripts/ai-workflow \
  ai-workflow:v1.1.0 \
  python main.py execute --phase all --issue 304

# 実行結果の確認
cat .ai-workflow/issue-304/08_report/output/final-report.md
```
```

**理由**: Docker環境のユーザーが新機能を使用する際の具体的な手順を提供するため。クイックスタートの流れに自然に組み込むことで、初心者でも容易に試せるようにした。

---

#### (5) セクション番号の調整
**影響範囲**:
- 旧セクション `4. BDDテスト` → 新セクション `5. BDDテスト`
- 旧セクション `5. ディレクトリ構成` → 新セクション `6. ディレクトリ構成`

**理由**: 新規セクション `4. 全フェーズ一括実行（オプション）` を追加したため、後続セクションの番号を繰り下げた。

---

## 3. 更新不要と判断したファイル

### 3.1 `scripts/ai-workflow/ARCHITECTURE.md`

**判断理由:**
- **アーキテクチャ構造に変更なし**: `execute_all_phases()` は既存の `_execute_phase()` を呼び出す薄いラッパー層として実装されている
- **新規コンポーネントなし**: 既存の Phase クラス、PhaseExecutor、ReviewChain をそのまま使用
- **データフロー変更なし**: metadata.json の構造、フェーズ間のデータ受け渡し方法は既存と同一
- **アーキテクチャ図への影響なし**: 図に示されている Phase 0-8 の構造は変更されていない

**今後の更新検討:**
- 将来的に `--phase all` の内部実装が複雑化した場合（例: 並列実行、フェーズスキップ機能など）には、ARCHITECTURE.md への追記を検討する

---

### 3.2 `scripts/ai-workflow/TROUBLESHOOTING.md`

**判断理由:**
- **新機能特有のエラーパターン未発生**: Phase 1-8 を個別実行した場合と同じエラーが発生するため、既存のトラブルシューティング情報で対応可能
- **既存Q&Aで対応可能**:
  - Q3-1: ワークフロー実行エラー → 個別フェーズと同じ対処法
  - Q3-2: ModuleNotFoundError → 依存パッケージの問題
  - Q3-3: metadata.json の UTF-8 エラー → エンコーディング問題
- **静的解析ベースのテスト結果**: 実環境でのユーザーフィードバックがまだ蓄積されていない

**今後の更新検討:**
- 実運用で以下のような事例が発生した場合、新規Q&Aを追加する:
  - Q: "Phase 5で失敗後、Phase 1から再実行すべきか？"
  - Q: "全フェーズ実行中に途中停止する方法は？"
  - Q: "Phase 0を含めて全実行したい場合は？"

---

## 4. 変更サマリー

| 項目 | 内容 |
|-----|------|
| 更新ファイル数 | 1ファイル |
| 調査ファイル数 | 3ファイル |
| 追加セクション数 | 1セクション（Docker環境での全フェーズ実行） |
| 追加行数（概算） | 約50行 |
| 変更の種類 | 機能追加（新規オプション `--phase all` のドキュメント化） |

---

## 5. レビューチェックリスト

- [x] ユーザー視点で必要な情報が追加されているか
- [x] 既存の文体・フォーマットと統一されているか
- [x] コード例が正確で実行可能か
- [x] セクション番号の整合性が取れているか
- [x] 日本語の表現が自然で理解しやすいか
- [x] 誤字脱字がないか
- [x] マークダウン記法が正しく適用されているか

---

## 6. 補足事項

### 6.1 ドキュメント更新の方針

今回の更新では、以下の3つの基準で更新要否を判断しました:

1. **ユーザーが知る必要があるか？**
   - ユーザーが新機能を使用するために必要な情報か
   - ユーザーの操作・理解に直接影響するか

2. **知らないと問題が起きるか？**
   - 情報不足により誤った使い方をする可能性があるか
   - トラブルシューティングに必要な情報か

3. **既存の内容が古くなっているか？**
   - 既存の記述と矛盾する内容があるか
   - 補完が必要な情報があるか

### 6.2 今後のドキュメントメンテナンス

**Phase 0-6 の成果物ドキュメント**:
- `.ai-workflow/issue-320/` 配下のドキュメントは、開発プロセスの記録として保持
- 将来的な機能拡張や保守の際の参照資料として活用
- ユーザー向けドキュメント（README.md等）とは区別して管理

**ユーザー向けドキュメント**:
- README.md: 新機能追加時は必ず更新
- ARCHITECTURE.md: アーキテクチャ変更時のみ更新
- TROUBLESHOOTING.md: ユーザーフィードバックに基づき随時更新

---

**ドキュメント更新完了**
**Phase 7 (documentation) 実行完了**: 2025-10-12
