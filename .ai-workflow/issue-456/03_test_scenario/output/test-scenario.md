# テストシナリオ - Issue #456

**作成日**: 2025年1月17日
**Issue番号**: #456
**タイトル**: [jenkins] AI Workflow用の汎用フォルダを追加
**Issue URL**: https://github.com/tielec/infrastructure-as-code/issues/456

---

## 0. Planning Document・Requirements Document・Design Documentとの整合性

本テストシナリオは、以下のドキュメントで策定された戦略に基づいて作成されます。

### Planning Phaseで決定されたテスト戦略

- **テスト戦略**: INTEGRATION_ONLY（シードジョブ実行による実環境確認）
- **テストコード戦略**: なし（YAML定義のため自動テスト不要）
- **理由**:
  - ロジックが存在しない（YAML定義のみ）
  - Jenkins UIでフォルダが正しく作成されるか確認
  - フォルダの階層構造が正しいか確認
  - displayNameとdescriptionが正しく設定されるか確認

### Requirements Documentで定義された受け入れ基準

- AC-1: develop用フォルダが正しく作成される
- AC-2: main用フォルダ（1つ目）が正しく作成される
- AC-3: main用フォルダ（2つ目）が正しく作成される
- AC-4: シードジョブが成功する
- AC-5: 既存フォルダに影響がない
- AC-6: YAML構文が正しい
- AC-7: Git差分が正しい
- AC-8: ドキュメントが更新されている（オプション）

### Design Documentで設計された実装内容

- フォルダパス: `AI_Workflow/develop-generic`, `AI_Workflow/main-generic-1`, `AI_Workflow/main-generic-2`
- displayName: 「汎用 - Develop」「汎用 - Main #1」「汎用 - Main #2」
- 変更対象ファイル: `jenkins/jobs/pipeline/_seed/job-creator/folder-config.yaml`のみ

---

## 1. テスト戦略サマリー

### 1.1 選択されたテスト戦略

**INTEGRATION_ONLY**（Integrationテストのみ）

### 1.2 テスト対象の範囲

| テスト対象 | 範囲 |
|-----------|------|
| **YAML定義** | `folder-config.yaml`に追加された3つのフォルダ定義 |
| **シードジョブ** | `Admin_Jobs/job-creator`の実行結果 |
| **Jenkins UI** | フォルダの作成状態、displayName、description、階層構造 |
| **既存フォルダ** | 既存のAI_Workflowフォルダおよび他のフォルダへの影響がないこと |

### 1.3 テストの目的

1. **フォルダ作成の検証**: 3つの汎用フォルダが正しく作成されることを確認
2. **プロパティ検証**: displayNameとdescriptionが設計通りに設定されることを確認
3. **階層構造検証**: AI_Workflowフォルダ配下に正しく配置されることを確認
4. **既存資産保護**: 既存フォルダ（動的フォルダ含む）に影響がないことを確認
5. **シードジョブ安定性**: YAML構文エラーによるシードジョブ失敗がないことを確認

### 1.4 テスト種別の範囲外

- **Unitテスト**: ロジックが存在しないため不要
- **BDDテスト**: エンドユーザー向けのビジネスロジックではないため不要
- **自動テストコード**: YAML定義のため、手動確認で十分

---

## 2. Integrationテストシナリオ

### 2.1 事前準備（Pre-Condition）

#### 2.1.1 環境確認

**シナリオ名**: テスト実行環境の事前確認

- **目的**: テスト実行に必要な環境が整っていることを確認
- **前提条件**: なし
- **テスト手順**:
  1. Jenkins環境が稼働していることを確認（Jenkins UIにアクセス可能）
  2. `Admin_Jobs/job-creator`シードジョブが存在することを確認
  3. `AI_Workflow`フォルダが存在することを確認（親フォルダ）
  4. Gitリポジトリ（infrastructure-as-code）がクローン済みであることを確認
  5. 編集権限があることを確認（`folder-config.yaml`を編集可能）
- **期待結果**: すべての項目がYESである
- **確認項目**:
  - [ ] Jenkins UIにアクセスできる
  - [ ] `Admin_Jobs/job-creator`が存在する
  - [ ] `AI_Workflow`フォルダが存在する
  - [ ] Gitリポジトリがクローン済み
  - [ ] ファイル編集権限がある

#### 2.1.2 既存フォルダのスナップショット取得

**シナリオ名**: 既存フォルダ構造のスナップショット取得

- **目的**: テスト後に既存フォルダへの影響を検証するため、現在の状態を記録
- **前提条件**: Jenkins環境が稼働中
- **テスト手順**:
  1. Jenkins UIで`AI_Workflow`フォルダにアクセス
  2. 配下のフォルダ一覧をスクリーンショットまたはテキストで記録
  3. 動的フォルダ（リポジトリ別フォルダ）の数を記録
  4. 他のトップレベルフォルダ（`Admin_Jobs`, `Code_Quality_Checker`等）の存在を確認
- **期待結果**: 既存フォルダのリストが記録される
- **確認項目**:
  - [ ] `AI_Workflow`配下のフォルダ数: ______個
  - [ ] 動的フォルダのリスト: ________________
  - [ ] トップレベルフォルダのリスト: ________________

---

### 2.2 YAML構文検証（シードジョブ実行前）

#### 2.2.1 YAML構文チェック

**シナリオ名**: folder-config.yamlのYAML構文検証

- **目的**: シードジョブ実行前にYAML構文エラーがないことを確認
- **前提条件**: `folder-config.yaml`に3つのフォルダ定義が追加済み
- **テスト手順**:
  1. `folder-config.yaml`をYAMLバリデータでパース
     - オンラインツール（例: https://www.yamllint.com/）を使用
     - またはローカルで`yamllint`コマンドを使用
  2. パース結果を確認（エラーがないこと）
  3. インデント（スペース2つ）が正しいことを確認
  4. 特殊文字のエスケープが正しいことを確認
- **期待結果**: YAML構文エラーが0件である
- **確認項目**:
  - [ ] YAMLパースが成功する
  - [ ] 構文エラーが0件
  - [ ] インデントがスペース2つで統一されている
  - [ ] 特殊文字が適切にエスケープされている

#### 2.2.2 Git差分確認

**シナリオ名**: folder-config.yamlのGit差分検証

- **目的**: 意図しない変更が含まれていないことを確認
- **前提条件**: `folder-config.yaml`が編集済み
- **テスト手順**:
  1. `git diff jenkins/jobs/pipeline/_seed/job-creator/folder-config.yaml`を実行
  2. 差分を確認
     - 追加箇所: 3つのフォルダ定義（develop-generic, main-generic-1, main-generic-2）
     - コメント: Issue番号、追加日、追加理由が含まれる
  3. 既存のフォルダ定義に変更がないことを確認
  4. 意図しない空白・改行の追加がないことを確認
- **期待結果**:
  - 3つのフォルダ定義のみが追加されている
  - 既存定義に意図しない変更がない
  - コメントが適切に追加されている
- **確認項目**:
  - [ ] 差分が3つのフォルダ定義のみである
  - [ ] 既存フォルダ定義に変更がない
  - [ ] コメントにIssue #456が含まれる
  - [ ] コメントに追加理由が含まれる
  - [ ] 意図しない空白・改行がない

---

### 2.3 シードジョブ実行テスト

#### 2.3.1 シードジョブの実行

**シナリオ名**: Admin_Jobs/job-creatorシードジョブの実行

- **目的**: フォルダ定義がJob DSLによって正しく処理されることを確認
- **前提条件**:
  - `folder-config.yaml`が編集済み
  - YAML構文チェックが完了
  - Gitコミット済み
- **テスト手順**:
  1. Jenkins UIにログイン
  2. `Admin_Jobs/job-creator`ジョブにアクセス
  3. 「Build Now」をクリックしてシードジョブを実行
  4. ビルドが開始されることを確認
  5. ビルドログ（Console Output）をリアルタイムで確認
  6. ビルドが完了するまで待機
- **期待結果**:
  - ビルドステータスが**SUCCESS**である
  - ビルドログにエラー・警告が出力されない
- **確認項目**:
  - [ ] ビルドステータス: SUCCESS
  - [ ] ビルドログにエラーがない
  - [ ] ビルドログに警告がない
  - [ ] ビルド時間が通常範囲内（+5秒以内）

#### 2.3.2 シードジョブのログ確認

**シナリオ名**: シードジョブのConsole Outputでフォルダ作成メッセージを確認

- **目的**: 3つのフォルダが実際に作成されたことをログで確認
- **前提条件**: シードジョブがSUCCESSで完了している
- **テスト手順**:
  1. シードジョブのConsole Outputにアクセス
  2. 以下のメッセージが含まれることを確認:
     - `Processing DSL script folders.groovy`
     - `GeneratedJob{name='AI_Workflow/develop-generic'}` または類似のメッセージ
     - `GeneratedJob{name='AI_Workflow/main-generic-1'}` または類似のメッセージ
     - `GeneratedJob{name='AI_Workflow/main-generic-2'}` または類似のメッセージ
  3. エラーメッセージがないことを確認
- **期待結果**:
  - 3つのフォルダ作成メッセージがログに出力される
  - YAML構文エラーやJob DSLエラーが発生しない
- **確認項目**:
  - [ ] `develop-generic`の作成メッセージがある
  - [ ] `main-generic-1`の作成メッセージがある
  - [ ] `main-generic-2`の作成メッセージがある
  - [ ] YAML構文エラーがない
  - [ ] Job DSLエラーがない

---

### 2.4 Jenkins UIでのフォルダ作成確認

#### 2.4.1 develop-generic フォルダの確認

**シナリオ名**: AI_Workflow/develop-generic フォルダが正しく作成されている

- **目的**: develop用汎用フォルダが設計通りに作成されていることを確認
- **前提条件**: シードジョブがSUCCESSで完了している
- **テスト手順**:
  1. Jenkins UIで`AI_Workflow`フォルダにアクセス
  2. `develop-generic`フォルダが表示されることを確認
  3. フォルダ名をクリックして詳細ページにアクセス
  4. displayNameを確認
  5. description（フォルダの説明）を確認
  6. フォルダアイコン（フォルダ型）が表示されることを確認
- **期待結果**:
  - フォルダパス: `AI_Workflow/develop-generic`
  - displayName: 「汎用 - Develop」
  - description: 以下の内容を含む
    - 「developブランチ用の汎用ワークフロー実行環境」
    - 「ai-workflow-agentの**最新バージョン**（developブランチ）を使用」
    - 「新機能のテスト、実験的な利用」
    - 「対象ブランチ: ai-workflow-agent: **develop**」
- **確認項目**:
  - [ ] `AI_Workflow/develop-generic`が存在する
  - [ ] displayNameが「汎用 - Develop」である
  - [ ] descriptionに「developブランチ用」が含まれる
  - [ ] descriptionに「最新バージョン」が含まれる
  - [ ] descriptionに「対象ブランチ: develop」が含まれる
  - [ ] フォルダアイコンが表示される

#### 2.4.2 main-generic-1 フォルダの確認

**シナリオ名**: AI_Workflow/main-generic-1 フォルダが正しく作成されている

- **目的**: main用汎用フォルダ（1つ目）が設計通りに作成されていることを確認
- **前提条件**: シードジョブがSUCCESSで完了している
- **テスト手順**:
  1. Jenkins UIで`AI_Workflow`フォルダにアクセス
  2. `main-generic-1`フォルダが表示されることを確認
  3. フォルダ名をクリックして詳細ページにアクセス
  4. displayNameを確認
  5. description（フォルダの説明）を確認
  6. フォルダアイコン（フォルダ型）が表示されることを確認
- **期待結果**:
  - フォルダパス: `AI_Workflow/main-generic-1`
  - displayName: 「汎用 - Main #1」
  - description: 以下の内容を含む
    - 「mainブランチ用の汎用ワークフロー実行環境（1つ目）」
    - 「ai-workflow-agentの**安定バージョン**（mainブランチ）を使用」
    - 「本番環境での利用、安定した動作が求められる場合」
    - 「対象ブランチ: ai-workflow-agent: **main**」
    - 「main用フォルダは2つあり、複数のワークフローを同時実行可能」
- **確認項目**:
  - [ ] `AI_Workflow/main-generic-1`が存在する
  - [ ] displayNameが「汎用 - Main #1」である
  - [ ] descriptionに「mainブランチ用」が含まれる
  - [ ] descriptionに「安定バージョン」が含まれる
  - [ ] descriptionに「対象ブランチ: main」が含まれる
  - [ ] descriptionに「並行利用」の説明が含まれる
  - [ ] フォルダアイコンが表示される

#### 2.4.3 main-generic-2 フォルダの確認

**シナリオ名**: AI_Workflow/main-generic-2 フォルダが正しく作成されている

- **目的**: main用汎用フォルダ（2つ目）が設計通りに作成されていることを確認
- **前提条件**: シードジョブがSUCCESSで完了している
- **テスト手順**:
  1. Jenkins UIで`AI_Workflow`フォルダにアクセス
  2. `main-generic-2`フォルダが表示されることを確認
  3. フォルダ名をクリックして詳細ページにアクセス
  4. displayNameを確認
  5. description（フォルダの説明）を確認
  6. フォルダアイコン（フォルダ型）が表示されることを確認
- **期待結果**:
  - フォルダパス: `AI_Workflow/main-generic-2`
  - displayName: 「汎用 - Main #2」
  - description: 以下の内容を含む
    - 「mainブランチ用の汎用ワークフロー実行環境（2つ目）」
    - 「ai-workflow-agentの**安定バージョン**（mainブランチ）を使用」
    - 「本番環境での利用、安定した動作が求められる場合」
    - 「対象ブランチ: ai-workflow-agent: **main**」
    - 「main用フォルダは2つあり、複数のワークフローを同時実行可能」
- **確認項目**:
  - [ ] `AI_Workflow/main-generic-2`が存在する
  - [ ] displayNameが「汎用 - Main #2」である
  - [ ] descriptionに「mainブランチ用」が含まれる
  - [ ] descriptionに「安定バージョン」が含まれる
  - [ ] descriptionに「対象ブランチ: main」が含まれる
  - [ ] descriptionに「並行利用」の説明が含まれる
  - [ ] フォルダアイコンが表示される

---

### 2.5 フォルダ階層構造の検証

#### 2.5.1 階層構造の確認

**シナリオ名**: AI_Workflowフォルダ配下に3つのフォルダが正しく配置されている

- **目的**: フォルダの階層構造が設計通りであることを確認
- **前提条件**: 3つのフォルダが作成済み
- **テスト手順**:
  1. Jenkins UIで`AI_Workflow`フォルダにアクセス
  2. パンくずリスト（Breadcrumb）を確認: `Dashboard > AI_Workflow`
  3. 配下のフォルダ一覧に以下が含まれることを確認:
     - `develop-generic`
     - `main-generic-1`
     - `main-generic-2`
  4. 各フォルダをクリックし、パンくずリストを確認:
     - `Dashboard > AI_Workflow > develop-generic`
     - `Dashboard > AI_Workflow > main-generic-1`
     - `Dashboard > AI_Workflow > main-generic-2`
  5. トップレベルフォルダ一覧に`develop-generic`等が表示されないことを確認（AI_Workflowの子である）
- **期待結果**:
  - 3つのフォルダがすべて`AI_Workflow`の直下に配置されている
  - 階層が`AI_Workflow/{フォルダ名}`である
  - トップレベルに誤って配置されていない
- **確認項目**:
  - [ ] `AI_Workflow`配下に3つのフォルダが表示される
  - [ ] `develop-generic`のパンくずリストが正しい
  - [ ] `main-generic-1`のパンくずリストが正しい
  - [ ] `main-generic-2`のパンくずリストが正しい
  - [ ] トップレベルに誤って配置されていない

#### 2.5.2 フォルダソート順の確認

**シナリオ名**: フォルダがアルファベット順または定義順に表示される

- **目的**: フォルダの表示順序が適切であることを確認（ユーザビリティ）
- **前提条件**: 3つのフォルダが作成済み
- **テスト手順**:
  1. Jenkins UIで`AI_Workflow`フォルダにアクセス
  2. フォルダ一覧の表示順序を確認
     - アルファベット順: `develop-generic` → `main-generic-1` → `main-generic-2`
     - または定義順（YAML定義順）
  3. 既存の動的フォルダと新規の静的フォルダが混在して表示されることを確認
- **期待結果**:
  - フォルダが適切な順序で表示される（アルファベット順または定義順）
  - 視認性が高い（developとmainが区別しやすい）
- **確認項目**:
  - [ ] フォルダがソートされて表示される
  - [ ] `develop-generic`が`main-generic-1`の前にある（アルファベット順の場合）
  - [ ] 既存の動的フォルダと混在している

---

### 2.6 既存フォルダへの影響確認

#### 2.6.1 既存の動的フォルダの保護

**シナリオ名**: AI_Workflow配下の既存動的フォルダが削除されていない

- **目的**: 既存のリポジトリ別動的フォルダに影響がないことを確認
- **前提条件**:
  - 2.1.2で取得したスナップショット
  - 3つのフォルダが作成済み
- **テスト手順**:
  1. Jenkins UIで`AI_Workflow`フォルダにアクセス
  2. 配下のフォルダ一覧を確認
  3. 2.1.2で記録した既存フォルダがすべて存在することを確認
  4. 動的フォルダ（リポジトリ別フォルダ）の数が変わっていないことを確認
  5. 各動的フォルダをクリックし、内部のジョブが正常に表示されることを確認
- **期待結果**:
  - 既存の動的フォルダがすべて存在する
  - フォルダ数が増加している（+3個）
  - 動的フォルダ内のジョブが正常に表示される
- **確認項目**:
  - [ ] 既存フォルダ数: ______個（2.1.2の記録と一致＋3）
  - [ ] 動的フォルダがすべて存在する
  - [ ] 動的フォルダ内のジョブが表示される
  - [ ] フォルダが削除されていない

#### 2.6.2 他のトップレベルフォルダの保護

**シナリオ名**: AI_Workflow以外のフォルダに影響がない

- **目的**: 他のトップレベルフォルダ（Admin_Jobs等）に影響がないことを確認
- **前提条件**:
  - 2.1.2で取得したスナップショット
  - 3つのフォルダが作成済み
- **テスト手順**:
  1. Jenkins UIのトップレベル（Dashboard）にアクセス
  2. 以下のフォルダが存在することを確認:
     - `Admin_Jobs`
     - `Account_Setup`
     - `Code_Quality_Checker`
     - `Shared_Library`
     - その他2.1.2で記録したフォルダ
  3. 各フォルダをクリックし、内部のジョブが正常に表示されることを確認
  4. フォルダのdisplayNameやdescriptionが変更されていないことを確認
- **期待結果**:
  - すべてのトップレベルフォルダが存在する
  - フォルダのプロパティに変更がない
  - ジョブが正常に表示される
- **確認項目**:
  - [ ] `Admin_Jobs`が存在し、正常である
  - [ ] `Code_Quality_Checker`が存在し、正常である
  - [ ] その他のフォルダがすべて存在する
  - [ ] フォルダのプロパティに変更がない
  - [ ] ジョブが正常に表示される

---

### 2.7 パフォーマンス検証

#### 2.7.1 シードジョブ実行時間の確認

**シナリオ名**: フォルダ追加によるシードジョブ実行時間への影響が軽微である

- **目的**: 非機能要件（NFR-1）を満たすことを確認（追加で5秒以上かからない）
- **前提条件**:
  - シードジョブの通常実行時間を把握（過去のビルド履歴から）
  - 3つのフォルダが作成済み
- **テスト手順**:
  1. シードジョブ（今回の実行）のビルド時間を確認
  2. 過去のシードジョブのビルド時間（平均）を確認
  3. 差分を計算: `今回のビルド時間 - 平均ビルド時間`
  4. 差分が5秒以内であることを確認
- **期待結果**:
  - ビルド時間の増加が5秒以内である
  - フォルダ作成処理が軽量である
- **確認項目**:
  - [ ] 今回のビルド時間: ______秒
  - [ ] 過去の平均ビルド時間: ______秒
  - [ ] 差分: ______秒（5秒以内）
  - [ ] パフォーマンス要件を満たしている

---

## 3. エラーケーステスト（異常系）

### 3.1 ロールバックシナリオ

#### 3.1.1 YAML構文エラー時のロールバック

**シナリオ名**: YAML構文エラーが発生した場合のロールバック手順

- **目的**: YAML構文エラーが発生した場合に、迅速にロールバックできることを確認
- **前提条件**:
  - **仮想的なエラー状態**: `folder-config.yaml`に構文エラーを意図的に挿入（テスト環境推奨）
  - またはエラー発生を想定した手順のドライラン
- **テスト手順**:
  1. `folder-config.yaml`に構文エラーを挿入（例: インデント崩し、クォート不一致）
  2. シードジョブを実行
  3. ビルドが失敗することを確認（ステータス: FAILURE）
  4. Console Outputでエラーメッセージを確認
  5. Gitで直前のコミットをrevert: `git revert <commit-hash>`
  6. シードジョブを再実行
  7. ビルドが成功することを確認（ステータス: SUCCESS）
- **期待結果**:
  - YAML構文エラーでビルドが失敗する
  - `git revert`でロールバック可能
  - ロールバック後にシードジョブが成功する
- **確認項目**:
  - [ ] YAML構文エラーでビルドが失敗する
  - [ ] エラーメッセージが明確である
  - [ ] `git revert`でロールバック可能
  - [ ] ロールバック後にビルドが成功する
  - [ ] フォルダが削除される（Job DSLの削除機能）

**注意**: このテストは破壊的なため、テスト環境で実施するか、手順のドライラン（実際には実行しない）で代替することを推奨します。

---

## 4. テストデータ

### 4.1 正常データ

#### 4.1.1 folder-config.yamlへの追加内容

```yaml
# Issue #456: AI Workflow用の汎用フォルダを追加
# 追加日: 2025-01-17
# URL: https://github.com/tielec/infrastructure-as-code/issues/456

folders:
  # ... 既存のフォルダ定義 ...

  # AI Workflow - develop用汎用フォルダ
  - path: "AI_Workflow/develop-generic"
    displayName: "汎用 - Develop"
    description: |
      developブランチ用の汎用ワークフロー実行環境

      ### 用途
      - ai-workflow-agentの**最新バージョン**（developブランチ）を使用
      - 新機能のテスト、実験的な利用
      - 特定リポジトリに依存しない汎用的なワークフロー

      ### 対象ブランチ
      - ai-workflow-agent: **develop**

      ### 推奨の使い方
      - 最新機能の検証
      - 新しいワークフローのテスト
      - リポジトリ横断的なタスク実行

      ### 注意事項
      - 開発中の機能のため、動作が不安定な場合があります
      - 本番環境での利用は避けてください
      - 安定した動作が必要な場合はmain用フォルダを使用してください

  # AI Workflow - main用汎用フォルダ（1つ目）
  - path: "AI_Workflow/main-generic-1"
    displayName: "汎用 - Main #1"
    description: |
      mainブランチ用の汎用ワークフロー実行環境（1つ目）

      ### 用途
      - ai-workflow-agentの**安定バージョン**（mainブランチ）を使用
      - 本番環境での利用、安定した動作が求められる場合
      - 特定リポジトリに依存しない汎用的なワークフロー

      ### 対象ブランチ
      - ai-workflow-agent: **main**

      ### 推奨の使い方
      - 本番環境でのワークフロー実行
      - 安定性が求められるタスク
      - リポジトリ横断的なタスク実行

      ### 並行利用について
      - main用フォルダは2つあり、複数のワークフローを同時実行可能です
      - 使用中は`main-generic-2`をご利用ください

  # AI Workflow - main用汎用フォルダ（2つ目）
  - path: "AI_Workflow/main-generic-2"
    displayName: "汎用 - Main #2"
    description: |
      mainブランチ用の汎用ワークフロー実行環境（2つ目）

      ### 用途
      - ai-workflow-agentの**安定バージョン**（mainブランチ）を使用
      - 本番環境での利用、安定した動作が求められる場合
      - 特定リポジトリに依存しない汎用的なワークフロー

      ### 対象ブランチ
      - ai-workflow-agent: **main**

      ### 推奨の使い方
      - 本番環境でのワークフロー実行
      - 安定性が求められるタスク
      - リポジトリ横断的なタスク実行

      ### 並行利用について
      - main用フォルダは2つあり、複数のワークフローを同時実行可能です
      - `main-generic-1`が使用中の場合はこちらをご利用ください
```

### 4.2 異常データ（エラーケース）

#### 4.2.1 YAML構文エラーのパターン

| エラーパターン | 例 | 期待されるエラーメッセージ |
|--------------|-----|--------------------------|
| インデント不一致 | `  path: "..."` が `path: "..."` （スペース0個） | `mapping values are not allowed here` |
| クォート不一致 | `path: "AI_Workflow/develop-generic` （閉じクォートなし） | `while scanning a quoted scalar` |
| YAMLキーの重複 | 同じ`path`を2回定義 | フォルダ作成時の競合エラー |
| 特殊文字の未エスケープ | description内に`:`や`#`を含む | パースエラーまたは意図しない解釈 |

**注意**: これらの異常データは、ロールバックテスト（3.1.1）またはYAML検証ツールでの検証に使用します。本番環境では使用しないでください。

---

## 5. テスト環境要件

### 5.1 必要なテスト環境

| 項目 | 要件 |
|------|------|
| **Jenkins環境** | 稼働中であり、シードジョブが実行可能な状態 |
| **Job DSL Plugin** | インストール済み |
| **Git環境** | `infrastructure-as-code`リポジトリがクローン済み |
| **権限** | `folder-config.yaml`の編集権限、シードジョブの実行権限 |
| **ブラウザ** | Jenkins UIにアクセス可能（Chrome、Firefox等） |

### 5.2 必要なツール

| ツール | 用途 | 必須/オプション |
|--------|------|----------------|
| **YAMLバリデータ** | YAML構文検証（オンラインツールまたはyamllint） | 必須 |
| **Git** | 差分確認、ロールバック | 必須 |
| **スクリーンショットツール** | テスト結果の記録 | オプション |
| **テキストエディタ** | チェックリストの記録 | オプション |

### 5.3 モック/スタブの必要性

**不要**

理由:
- Integrationテストは実環境（Jenkins）で実施
- 外部システム連携なし
- モック/スタブによるテストは対象外（テスト戦略: INTEGRATION_ONLY）

---

## 6. テスト実施チェックリスト

### 6.1 事前準備

- [ ] Jenkins環境が稼働している
- [ ] `Admin_Jobs/job-creator`シードジョブが存在する
- [ ] `AI_Workflow`フォルダが存在する
- [ ] Gitリポジトリがクローン済み
- [ ] 編集権限がある
- [ ] 既存フォルダのスナップショットを取得した

### 6.2 YAML構文検証

- [ ] YAMLバリデータでパースが成功した
- [ ] YAML構文エラーが0件
- [ ] インデントがスペース2つで統一されている
- [ ] Git差分が正しい（3つのフォルダ定義のみ）

### 6.3 シードジョブ実行

- [ ] シードジョブのビルドステータスがSUCCESS
- [ ] ビルドログにエラーがない
- [ ] 3つのフォルダ作成メッセージがログに出力された

### 6.4 フォルダ作成確認

- [ ] `AI_Workflow/develop-generic`が存在する
- [ ] `AI_Workflow/main-generic-1`が存在する
- [ ] `AI_Workflow/main-generic-2`が存在する
- [ ] 各フォルダのdisplayNameが正しい
- [ ] 各フォルダのdescriptionが正しい

### 6.5 既存フォルダ保護

- [ ] 既存の動的フォルダがすべて存在する
- [ ] 他のトップレベルフォルダに影響がない
- [ ] ジョブが正常に表示される

### 6.6 パフォーマンス

- [ ] ビルド時間の増加が5秒以内

---

## 7. テスト実施記録テンプレート

### 7.1 実施日時・実施者

| 項目 | 内容 |
|------|------|
| テスト実施日 | ____年____月____日 |
| テスト実施者 | ________________ |
| Jenkins環境 | ________________（URL） |
| Gitコミットハッシュ | ________________ |

### 7.2 テスト結果サマリー

| テストシナリオ | 結果（Pass/Fail） | 備考 |
|---------------|------------------|------|
| 2.1.1 環境確認 | ☐ Pass ☐ Fail | |
| 2.1.2 スナップショット取得 | ☐ Pass ☐ Fail | |
| 2.2.1 YAML構文チェック | ☐ Pass ☐ Fail | |
| 2.2.2 Git差分確認 | ☐ Pass ☐ Fail | |
| 2.3.1 シードジョブ実行 | ☐ Pass ☐ Fail | |
| 2.3.2 ログ確認 | ☐ Pass ☐ Fail | |
| 2.4.1 develop-generic確認 | ☐ Pass ☐ Fail | |
| 2.4.2 main-generic-1確認 | ☐ Pass ☐ Fail | |
| 2.4.3 main-generic-2確認 | ☐ Pass ☐ Fail | |
| 2.5.1 階層構造確認 | ☐ Pass ☐ Fail | |
| 2.5.2 フォルダソート順確認 | ☐ Pass ☐ Fail | |
| 2.6.1 既存動的フォルダ保護 | ☐ Pass ☐ Fail | |
| 2.6.2 他のフォルダ保護 | ☐ Pass ☐ Fail | |
| 2.7.1 パフォーマンス確認 | ☐ Pass ☐ Fail | |

### 7.3 スクリーンショット記録

以下のスクリーンショットを取得することを推奨：

1. シードジョブのConsole Output（SUCCESS表示）
2. `AI_Workflow`フォルダのフォルダ一覧（3つのフォルダが表示）
3. `AI_Workflow/develop-generic`のフォルダページ（displayNameとdescription）
4. `AI_Workflow/main-generic-1`のフォルダページ（displayNameとdescription）
5. `AI_Workflow/main-generic-2`のフォルダページ（displayNameとdescription）

---

## 8. 品質ゲート確認（Phase 3）

本テストシナリオが以下の品質ゲートを満たしていることを確認：

- [x] **Phase 2の戦略に沿ったテストシナリオである**
  - テスト戦略: INTEGRATION_ONLYに準拠
  - シードジョブ実行による実環境確認
  - Jenkins UIでのフォルダ作成確認

- [x] **主要な正常系がカバーされている**
  - 3つのフォルダ作成確認（2.4.1〜2.4.3）
  - displayName/descriptionの検証
  - 階層構造の検証
  - シードジョブ成功の検証

- [x] **主要な異常系がカバーされている**
  - YAML構文エラー時のロールバック（3.1.1）
  - 既存フォルダへの影響がないことの検証（2.6.1〜2.6.2）

- [x] **期待結果が明確である**
  - 各テストシナリオに期待結果を明記
  - 確認項目をチェックリスト形式で記載
  - テスト実施記録テンプレートを提供

---

## 9. 次のフェーズへの引き継ぎ事項

### Phase 4（実装）で実施すべき事項

1. **folder-config.yamlの編集**
   - 本テストシナリオ4.1.1の正常データを使用
   - コメント追加（Issue番号、追加日、追加理由、背景説明）

2. **YAML検証**
   - テストシナリオ2.2.1のYAML構文チェック手順に従う

3. **Git操作**
   - テストシナリオ2.2.2のGit差分確認手順に従う

### Phase 6（テスト実行）で実施すべき事項

1. **本テストシナリオに従ってテストを実施**
   - セクション2（Integrationテストシナリオ）のすべての手順を実行
   - セクション6（テスト実施チェックリスト）をすべてチェック
   - セクション7（テスト実施記録テンプレート）に結果を記録

2. **スクリーンショットの取得**
   - セクション7.3のスクリーンショットをすべて取得
   - テスト結果レポートに添付

3. **エラー発生時の対応**
   - セクション3.1.1のロールバック手順に従う
   - エラー内容を記録し、Phase 4実装にフィードバック

---

## 10. 完了条件（Definition of Done）

Phase 3（テストシナリオ）が完了とみなされる条件：

1. [x] テスト戦略（INTEGRATION_ONLY）に沿ったシナリオが作成されている
2. [x] 要件定義書の受け入れ基準（AC-1〜AC-8）がすべてカバーされている
3. [x] 設計書の実装内容がすべてテスト対象に含まれている
4. [x] 正常系のテストシナリオが具体的に記載されている
5. [x] 異常系（ロールバック）のテストシナリオが記載されている
6. [x] 期待結果が明確であり、検証可能である
7. [x] テスト実施チェックリストが提供されている
8. [x] テスト実施記録テンプレートが提供されている
9. [x] 品質ゲート（4つの必須要件）がすべて満たされている
10. [x] 次フェーズへの引き継ぎ事項が明確である

---

**テストシナリオ作成者**: Claude (AI Assistant)
**レビュー待ち**: Phase 3品質ゲート確認
**次のフェーズ**: Phase 4（実装）
