# テスト実行フェーズ - 修正プロンプト

## タスク概要
レビューで指摘された問題を修正し、テストを再実行してください。

**重要**: Phase 5でテストが失敗した場合、**Phase 4（実装）に戻って実装を修正**する必要があります。

## レビュー結果
品質ゲート評価と詳細レビューを実施する前に、Planning Documentを読み込んで、Phase 6のタスクチェックリストとの照合を行います。
Planning.mdから、Phase 6のタスクチェックリストを確認しました。以下のタスクが定義されています：

**Phase 6: テスト実行**
- [ ] Task 6-1: シードジョブ実行 (0.25h)
- [ ] Task 6-2: テストケース1実行 (0.5h) - ドラフトPRスキップ確認
- [ ] Task 6-3: テストケース2実行 (0.5h) - ドラフト解除時の実行確認
- [ ] Task 6-4: テストケース3実行（回帰テスト） (0.5h)

**品質ゲート（Phase 6）**:
- [ ] シードジョブが正常に完了している
- [ ] テストケース1が成功している（ドラフトPRスキップ）
- [ ] テストケース2が成功している（ドラフト解除後実行）
- [ ] テストケース3が成功している（非ドラフトPR回帰テスト）
- [ ] すべてのテスト結果が文書化されている

それでは、test-result.mdの内容と照合します。test-result.mdによれば、**手動テストは未実施**であり、テスト実行待ちの状態です。すべてのタスクが未完了です。

Planning.mdのPhase 6チェックリストは**すべて未完了のまま（[ ]）**となります。

---

## 品質ゲート評価

**⚠️ 重要: 各項目に対して明示的にPASS/FAILを判定してください。1つでもFAILがあれば最終判定は自動的にFAILです。**

- [ ] **テストが実行されている**: **FAIL** - test-result.mdの現在の状態は「手動テスト実行待ち」であり、実際のテストは一切実行されていません。テスト実行コマンドやテスト出力の記録がありません。
- [ ] **主要なテストケースが成功している**: **FAIL** - テストが実行されていないため、主要なテストケース（TC1: ドラフトPRスキップ、TC2: ドラフト解除時の実行、TC3: 回帰テスト）の成功が確認できません。
- [ ] **失敗したテストは分析されている**: **N/A (PASS扱い)** - テストが実行されていないため、失敗したテストもありません。この項目は該当なしとしてPASS扱いとします。

**品質ゲート総合判定: FAIL**
- 理由: 上記3項目のうち2項目がFAIL（テスト実行、主要テストケース成功）

**品質ゲート判定がFAILのため、最終判定は自動的にFAILになります。**

---

## Planning Phaseチェックリスト照合結果

test-result.mdは「手動テスト実行待ち」の状態であり、Jenkins環境での手動テストが未実施です。Planning.mdのPhase 6で定義されたすべてのタスクが未完了です。

**未完了タスク**:
- [ ] Task 6-1: シードジョブ実行
- [ ] Task 6-2: テストケース1実行（ドラフトPRスキップ確認）
- [ ] Task 6-3: テストケース2実行（ドラフト解除時の実行確認）
- [ ] Task 6-4: テストケース3実行（回帰テスト）

**未達成の品質ゲート（Phase 6）**:
- [ ] シードジョブが正常に完了している
- [ ] テストケース1が成功している（ドラフトPRスキップ）
- [ ] テストケース2が成功している（ドラフト解除後実行）
- [ ] テストケース3が成功している（非ドラフトPR回帰テスト）
- [ ] すべてのテスト結果が文書化されている

Planning.mdのチェックボックスは**現時点では変更不要**です（すべて未完了のため、`[ ]` のまま）。実際にJenkins環境で手動テストを実施し、結果を記録した後に更新すべきです。

---

## 詳細レビュー

### 1. テスト実行の確認

**懸念点**:
- **テストが全く実行されていません**。test-result.mdは実質的に「テスト実行ガイド」であり、テスト結果レポートではありません。
- テスト実行コマンドの記録なし
- テスト出力の記録なし
- 実際のビルドログやスクリーンショットなし
- Jenkins環境での検証が一切行われていません

**状況説明**:
test-result.mdは以下の内容を含んでいますが、実際のテスト実行記録ではありません：
- テスト戦略の説明
- 手動テストシナリオの定義（Phase 3で作成済み）
- テスト実行手順の詳細ガイド
- 期待される結果のテンプレート
- トラブルシューティングガイド

これは「テスト準備完了」の状態であり、「テスト実行完了」ではありません。

### 2. 主要テストケースの成功

**懸念点**:
- テストが実行されていないため、主要なテストケースの成功は確認できません
- 以下のクリティカルなテストケースが未実施：
  - **TC1**: ドラフトPR作成時のスキップ確認（新機能の核心）
  - **TC2**: ドラフト解除時の実行確認（正常系の動作確認）
  - **TC3**: 非ドラフトPRの回帰テスト（既存機能への影響確認）
  - **TC5**: シードジョブでのDSL反映確認（設定変更の反映確認）

### 3. 失敗したテストの分析

**評価**: この項目は該当なし（N/A）
- テストが実行されていないため、失敗したテストもありません
- test-result.mdにはトラブルシューティングガイドが記載されていますが、実際の失敗分析ではありません

### 4. テスト範囲

**良好な点**:
- test-result.mdには詳細なテスト実行ガイドが記載されており、テストシナリオの準備は完璧です
- 5つのテストケース（TC1〜TC5）が明確に定義されています
- 各テストケースの確認項目チェックリスト、期待結果、実行手順が詳細に記載されています
- 見積もり時間も明記されています（合計2時間）

**懸念点**:
- 準備は完璧ですが、実行が未着手です
- Jenkins環境でのアクセスが必要であり、AI環境では実行できないという制約があります

---

## ブロッカー（BLOCKER）

**次フェーズに進めない重大な問題**

### 1. **手動テストが未実施**
- **問題**: test-result.mdは「テスト実行ガイド」であり、実際のテスト結果レポートではありません。Jenkins環境での手動テストが一切実行されていません。
- **影響**: 
  - 実装コードが実際に動作するか検証されていない
  - ドラフトPRフィルタリング機能が正しく動作するか不明
  - 既存の非ドラフトPRへの影響（回帰リスク）が未検証
  - OpenAI API呼び出しが正しくスキップされるか未確認
- **対策**: 
  - Jenkins管理者がtest-result.mdの「手動テスト実行ガイド」に従ってテストを実施する必要があります
  - 5つのテストケース（TC1〜TC5）をJenkins環境で実行
  - テスト結果（PASS/FAIL）、スクリーンショット、実際のログをtest-result.mdに追記
  - **Phase 6に留まり、テストを完了してから次フェーズへ進むべきです**

### 2. **Planning.mdのPhase 6タスクがすべて未完了**
- **問題**: Planning.mdで定義された4つのタスク（Task 6-1〜6-4）がすべて未完了です
- **影響**:
  - プロジェクト計画に沿ってタスクが完了していない
  - Phase 6の品質ゲート（5項目）がすべて未達成
- **対策**:
  - 各タスクを順番に実行し、完了後にPlanning.mdのチェックボックスを更新
  - Task 6-1: シードジョブ実行
  - Task 6-2: テストケース1実行（ドラフトPRスキップ）
  - Task 6-3: テストケース2実行（ドラフト解除時の実行）
  - Task 6-4: テストケース3実行（回帰テスト）

---

## 改善提案（SUGGESTION）

現時点では改善提案はありません。まずブロッカーを解消する必要があります。

テスト実施後に以下の改善提案が考えられます（テスト実施後に再評価）：
- テストケース4（パラメータ欠落時のフェイルセーフ）の実施
- テストケース5（シードジョブDSL反映確認）の詳細検証
- テスト結果の視覚的な証跡（スクリーンショット）の追加

---

## 総合評価

test-result.mdは**テスト準備段階の成果物**であり、Phase 6「テスト実行」フェーズの完了基準を満たしていません。

**現状の位置づけ**:
- ✅ **テスト準備**: 完璧に完了
  - 詳細なテスト実行ガイドが作成されています
  - テストシナリオ、確認項目、期待結果がすべて明確です
  - 見積もり時間（合計2時間）も適切です
- ❌ **テスト実行**: 未着手
  - Jenkins環境での手動テストが一切実行されていません
  - テスト結果の記録がありません

**主な懸念点**:
- 実装コードが実際に動作するか検証されていない
- Planning.mdのPhase 6タスクがすべて未完了
- Phase 6の品質ゲートがすべて未達成

**次のアクション**:
1. **Jenkins管理者が手動テストを実施する**（見積もり2時間）
2. **テスト結果をtest-result.mdに追記する**（各テストケースのPASS/FAIL、スクリーンショット、実際のログ）
3. **Planning.mdのPhase 6チェックリストを更新する**
4. **品質ゲート（3項目）をクリアしたことを確認する**
5. **Phase 7（ドキュメント作成）へ進む**

**評価**:
test-result.mdの内容自体は非常に高品質です。テスト実行ガイドとしては100点満点です。しかし、Phase 6の目的は「テスト実行」であり、「テスト準備」ではありません。実際のテスト実行が完了するまで、Phase 6は完了とみなせません。

---
**判定: FAIL**

**理由**: 品質ゲート2項目がFAIL（テスト実行、主要テストケース成功）。手動テストが未実施であり、Planning.mdのPhase 6タスクがすべて未完了。Jenkins環境での手動テスト実施が必須です。
Planning.mdから、Phase 6のタスクチェックリストを確認しました。以下のタスクが定義されています：

**Phase 6: テスト実行**
- [ ] Task 6-1: シードジョブ実行 (0.25h)
- [ ] Task 6-2: テストケース1実行 (0.5h) - ドラフトPRスキップ確認
- [ ] Task 6-3: テストケース2実行 (0.5h) - ドラフト解除時の実行確認
- [ ] Task 6-4: テストケース3実行（回帰テスト） (0.5h)

**品質ゲート（Phase 6）**:
- [ ] シードジョブが正常に完了している
- [ ] テストケース1が成功している（ドラフトPRスキップ）
- [ ] テストケース2が成功している（ドラフト解除後実行）
- [ ] テストケース3が成功している（非ドラフトPR回帰テスト）
- [ ] すべてのテスト結果が文書化されている

それでは、test-result.mdの内容と照合します。test-result.mdによれば、**手動テストは未実施**であり、テスト実行待ちの状態です。すべてのタスクが未完了です。

Planning.mdのPhase 6チェックリストは**すべて未完了のまま（[ ]）**となります。

---

## 品質ゲート評価

**⚠️ 重要: 各項目に対して明示的にPASS/FAILを判定してください。1つでもFAILがあれば最終判定は自動的にFAILです。**

- [ ] **テストが実行されている**: **FAIL** - test-result.mdの現在の状態は「手動テスト実行待ち」であり、実際のテストは一切実行されていません。テスト実行コマンドやテスト出力の記録がありません。
- [ ] **主要なテストケースが成功している**: **FAIL** - テストが実行されていないため、主要なテストケース（TC1: ドラフトPRスキップ、TC2: ドラフト解除時の実行、TC3: 回帰テスト）の成功が確認できません。
- [ ] **失敗したテストは分析されている**: **N/A (PASS扱い)** - テストが実行されていないため、失敗したテストもありません。この項目は該当なしとしてPASS扱いとします。

**品質ゲート総合判定: FAIL**
- 理由: 上記3項目のうち2項目がFAIL（テスト実行、主要テストケース成功）

**品質ゲート判定がFAILのため、最終判定は自動的にFAILになります。**

---

## Planning Phaseチェックリスト照合結果

test-result.mdは「手動テスト実行待ち」の状態であり、Jenkins環境での手動テストが未実施です。Planning.mdのPhase 6で定義されたすべてのタスクが未完了です。

**未完了タスク**:
- [ ] Task 6-1: シードジョブ実行
- [ ] Task 6-2: テストケース1実行（ドラフトPRスキップ確認）
- [ ] Task 6-3: テストケース2実行（ドラフト解除時の実行確認）
- [ ] Task 6-4: テストケース3実行（回帰テスト）

**未達成の品質ゲート（Phase 6）**:
- [ ] シードジョブが正常に完了している
- [ ] テストケース1が成功している（ドラフトPRスキップ）
- [ ] テストケース2が成功している（ドラフト解除後実行）
- [ ] テストケース3が成功している（非ドラフトPR回帰テスト）
- [ ] すべてのテスト結果が文書化されている

Planning.mdのチェックボックスは**現時点では変更不要**です（すべて未完了のため、`[ ]` のまま）。実際にJenkins環境で手動テストを実施し、結果を記録した後に更新すべきです。

---

## 詳細レビュー

### 1. テスト実行の確認

**懸念点**:
- **テストが全く実行されていません**。test-result.mdは実質的に「テスト実行ガイド」であり、テスト結果レポートではありません。
- テスト実行コマンドの記録なし
- テスト出力の記録なし
- 実際のビルドログやスクリーンショットなし
- Jenkins環境での検証が一切行われていません

**状況説明**:
test-result.mdは以下の内容を含んでいますが、実際のテスト実行記録ではありません：
- テスト戦略の説明
- 手動テストシナリオの定義（Phase 3で作成済み）
- テスト実行手順の詳細ガイド
- 期待される結果のテンプレート
- トラブルシューティングガイド

これは「テスト準備完了」の状態であり、「テスト実行完了」ではありません。

### 2. 主要テストケースの成功

**懸念点**:
- テストが実行されていないため、主要なテストケースの成功は確認できません
- 以下のクリティカルなテストケースが未実施：
  - **TC1**: ドラフトPR作成時のスキップ確認（新機能の核心）
  - **TC2**: ドラフト解除時の実行確認（正常系の動作確認）
  - **TC3**: 非ドラフトPRの回帰テスト（既存機能への影響確認）
  - **TC5**: シードジョブでのDSL反映確認（設定変更の反映確認）

### 3. 失敗したテストの分析

**評価**: この項目は該当なし（N/A）
- テストが実行されていないため、失敗したテストもありません
- test-result.mdにはトラブルシューティングガイドが記載されていますが、実際の失敗分析ではありません

### 4. テスト範囲

**良好な点**:
- test-result.mdには詳細なテスト実行ガイドが記載されており、テストシナリオの準備は完璧です
- 5つのテストケース（TC1〜TC5）が明確に定義されています
- 各テストケースの確認項目チェックリスト、期待結果、実行手順が詳細に記載されています
- 見積もり時間も明記されています（合計2時間）

**懸念点**:
- 準備は完璧ですが、実行が未着手です
- Jenkins環境でのアクセスが必要であり、AI環境では実行できないという制約があります

---

## ブロッカー（BLOCKER）

**次フェーズに進めない重大な問題**

### 1. **手動テストが未実施**
- **問題**: test-result.mdは「テスト実行ガイド」であり、実際のテスト結果レポートではありません。Jenkins環境での手動テストが一切実行されていません。
- **影響**: 
  - 実装コードが実際に動作するか検証されていない
  - ドラフトPRフィルタリング機能が正しく動作するか不明
  - 既存の非ドラフトPRへの影響（回帰リスク）が未検証
  - OpenAI API呼び出しが正しくスキップされるか未確認
- **対策**: 
  - Jenkins管理者がtest-result.mdの「手動テスト実行ガイド」に従ってテストを実施する必要があります
  - 5つのテストケース（TC1〜TC5）をJenkins環境で実行
  - テスト結果（PASS/FAIL）、スクリーンショット、実際のログをtest-result.mdに追記
  - **Phase 6に留まり、テストを完了してから次フェーズへ進むべきです**

### 2. **Planning.mdのPhase 6タスクがすべて未完了**
- **問題**: Planning.mdで定義された4つのタスク（Task 6-1〜6-4）がすべて未完了です
- **影響**:
  - プロジェクト計画に沿ってタスクが完了していない
  - Phase 6の品質ゲート（5項目）がすべて未達成
- **対策**:
  - 各タスクを順番に実行し、完了後にPlanning.mdのチェックボックスを更新
  - Task 6-1: シードジョブ実行
  - Task 6-2: テストケース1実行（ドラフトPRスキップ）
  - Task 6-3: テストケース2実行（ドラフト解除時の実行）
  - Task 6-4: テストケース3実行（回帰テスト）

---

## 改善提案（SUGGESTION）

現時点では改善提案はありません。まずブロッカーを解消する必要があります。

テスト実施後に以下の改善提案が考えられます（テスト実施後に再評価）：
- テストケース4（パラメータ欠落時のフェイルセーフ）の実施
- テストケース5（シードジョブDSL反映確認）の詳細検証
- テスト結果の視覚的な証跡（スクリーンショット）の追加

---

## 総合評価

test-result.mdは**テスト準備段階の成果物**であり、Phase 6「テスト実行」フェーズの完了基準を満たしていません。

**現状の位置づけ**:
- ✅ **テスト準備**: 完璧に完了
  - 詳細なテスト実行ガイドが作成されています
  - テストシナリオ、確認項目、期待結果がすべて明確です
  - 見積もり時間（合計2時間）も適切です
- ❌ **テスト実行**: 未着手
  - Jenkins環境での手動テストが一切実行されていません
  - テスト結果の記録がありません

**主な懸念点**:
- 実装コードが実際に動作するか検証されていない
- Planning.mdのPhase 6タスクがすべて未完了
- Phase 6の品質ゲートがすべて未達成

**次のアクション**:
1. **Jenkins管理者が手動テストを実施する**（見積もり2時間）
2. **テスト結果をtest-result.mdに追記する**（各テストケースのPASS/FAIL、スクリーンショット、実際のログ）
3. **Planning.mdのPhase 6チェックリストを更新する**
4. **品質ゲート（3項目）をクリアしたことを確認する**
5. **Phase 7（ドキュメント作成）へ進む**

**評価**:
test-result.mdの内容自体は非常に高品質です。テスト実行ガイドとしては100点満点です。しかし、Phase 6の目的は「テスト実行」であり、「テスト準備」ではありません。実際のテスト実行が完了するまで、Phase 6は完了とみなせません。

---
**判定: FAIL**

**理由**: 品質ゲート2項目がFAIL（テスト実行、主要テストケース成功）。手動テストが未実施であり、Planning.mdのPhase 6タスクがすべて未完了。Jenkins環境での手動テスト実施が必須です。

## 参考情報

### テスト結果
@.ai-workflow/issue-431/06_testing/output/test-result.md

### 実装ログ
@.ai-workflow/issue-431/04_implementation/output/implementation.md

### テストシナリオ
@.ai-workflow/issue-431/03_test_scenario/output/test-scenario.md

## 修正指示

### ブロッカー（BLOCKER）の解消

レビュー結果の「ブロッカー」セクションに記載された問題は、**次フェーズに進めない重大な問題**です。

**重要な判断**:
- **クリティカルなテスト失敗がある場合**: Phase 4に戻って実装を修正する必要があります
- **テスト環境の問題の場合**: テスト環境を修正してテストを再実行します

**Phase 4に戻る判断基準**:
- クリティカルパスのテストが失敗している
- 正常系のテストが失敗している
- 実装に明らかなバグがある

**Phase 5内で対応できる問題**:
- テスト環境の設定ミス
- テストデータの準備不足
- テスト実行コマンドの誤り

### 修正方針の決定

レビュー結果を確認し、以下のいずれかを選択してください：

#### 選択肢1: Phase 4に戻って実装を修正

実装に問題がある場合は、このプロンプトでは対応できません。
**Phase 4のrevise()を実行する必要があります**。

この場合、以下を記録してください：

```markdown
# テスト失敗による実装修正の必要性

## 修正が必要な理由
（なぜPhase 4に戻る必要があるか）

## 失敗したテスト
（どのテストが失敗したか）

## 必要な実装修正
（実装のどこをどう修正すべきか）
```

これを `.ai-workflow/issue-431/06_testing/output/test-result.md` に追記してください。

#### 選択肢2: テスト環境を修正してテストを再実行

テスト環境に問題がある場合は、環境を修正してテストを再実行してください。

**修正手順**:
1. テスト環境の問題を特定
2. 環境を修正（依存パッケージのインストール、設定ファイルの修正等）
3. テストを再実行
4. テスト結果を記録

## 修正後の確認事項

修正完了後、以下を確認してください：

1. **ブロッカーが解消されたか**
   - レビューで指摘されたすべてのブロッカーに対応したか

2. **主要なテストが成功しているか**
   - クリティカルパスのテストが成功しているか

3. **次フェーズへの準備**
   - Phase 6（ドキュメント作成）に進めるか
   - またはPhase 4に戻る必要があるか

## テスト結果の更新

テストを再実行した場合、結果を `.ai-workflow/issue-{issue_number}/06_testing/output/test-result.md` に追記してください：

```markdown
## 再実行結果

### 再実行1: YYYY-MM-DD HH:MM:SS
- **修正内容**: （何を修正したか）
- **成功**: Y個
- **失敗**: Z個
- **変更**: （前回からの変化）
```

## 出力形式

**重要**: 修正後のテスト結果を `.ai-workflow/issue-{issue_number}/06_testing/output/test-result.md` として**必ず上書き保存**してください。既存のファイルがある場合は、古い内容を完全に置き換えて、最新のテスト結果のみを記録してください。

## 修正開始

上記を踏まえ、適切な対応を実施してください。
