# 要件定義書 - Issue #415

## ドキュメント情報

- **Issue番号**: #415
- **タイトル**: [FOLLOW-UP] Issue #411 - 残タスク
- **Issue URL**: https://github.com/tielec/infrastructure-as-code/issues/415
- **ラベル**: enhancement, ai-workflow-follow-up
- **作成日**: 2025年
- **作成者**: Claude AI (AI Workflow Requirements Agent)

---

## 0. Planning Documentの確認

### 開発計画の概要

Planning Documentを確認した結果、以下の戦略が策定されています：

- **実装戦略**: REFACTOR（既存コードの削除と簡素化）
- **テスト戦略**: INTEGRATION_ONLY（統合テストのみ）
- **テストコード戦略**: EXTEND_TEST（既存テストの再利用）
- **総工数**: 2.5~4.0時間
- **総合リスク**: 低
- **複雑度**: 簡単

### 主要な前提条件

Issue #411の成果物を基盤として、以下が完了済み：
- バックアップブランチ `archive/ai-workflow-v1-python` の作成
- V1への参照の完全削除（0件確認）
- 12個の統合テストの実施（成功率100%）
- 復元手順の検証（1秒未満で復元可能）

---

## 1. 概要

### 背景

AI Workflow V2 (TypeScript版) への移行作業（Issue #411）が完了し、Evaluation Phase（フェーズ9）で以下の残タスクが明確化されました：

1. **削除実行**: V1 (Python版) の物理削除とコミット作成
2. **完了報告**: Issue #411への作業完了報告の投稿
3. **動作確認**: Jenkins環境でのV2ジョブ動作確認（推奨）

Issue #411では、削除の準備作業（DEPRECATED化、バックアップ作成、参照削除、テスト実施）が完了しており、本Issueではその最終仕上げを行います。

### 目的

- **技術的価値**: V1コードの物理削除により、コードベースを簡素化し、開発者の混乱を防止
- **運用的価値**: 削除作業の完了報告により、Issue #411のライフサイクルを完結
- **品質保証**: Jenkins環境での実機確認により、V2への完全移行を保証

### ビジネス価値

- **メンテナンス性向上**: 2つのワークフローシステム（V1/V2）を1つに統一し、保守コストを削減
- **開発者体験向上**: 単一のワークフローシステムにより、開発者の学習コスト削減
- **技術負債解消**: 非推奨コードの完全削除により、将来的な混乱を防止

---

## 2. 機能要件

### FR-001: V1ディレクトリの削除実行（優先度: 高）

**要件**: `scripts/ai-workflow/` ディレクトリを完全に削除し、Gitコミットを作成する。

**詳細**:
- 削除コマンド: `git rm -rf scripts/ai-workflow/`
- 削除前にバックアップブランチの存在を確認
- 削除前にV1参照箇所が0件であることを再確認（念のため）
- コミットメッセージはCLAUDE.md規約（line 348-360）に準拠
- Co-Authorクレジットを追加しない（CLAUDE.md line 364）

**該当Phase**: Phase 4 (Implementation)

### FR-002: コミットメッセージの作成（優先度: 高）

**要件**: CLAUDE.md規約に準拠したコミットメッセージを作成する。

**詳細**:
- フォーマット: `[scripts] remove: AI Workflow V1 (Python版) を削除`
- 本文に以下を含める：
  - 削除理由（V2への移行完了）
  - バックアップブランチ情報（`archive/ai-workflow-v1-python`）
  - 復元手順の簡易説明
  - Issue #415へのリンク
- 禁止事項: Co-Authorクレジットの追加（CLAUDE.md line 364）

**該当Phase**: Phase 4 (Implementation)

### FR-003: Issue #411への完了報告投稿（優先度: 高）

**要件**: Issue #411のコメント欄に削除完了報告を投稿する。

**詳細**:
- 報告内容:
  - 削除完了のサマリー（削除対象ファイル数、実行日時）
  - テスト結果の要約（Issue #411で実施した12個のテストの成功率）
  - バックアップ情報（ブランチ名、復元コマンド、復元時間）
  - 追加で実施したテストの結果（存在する場合）
- フォーマット: マークダウン形式
- Issue #411のクローズ判断を含める（完了確認後）

**該当Phase**: Phase 8 (Report)

### FR-004: Jenkins環境でのV2ジョブ動作確認（優先度: 低・推奨）

**要件**: Jenkins環境で `AI_Workflow/ai_workflow_orchestrator` ジョブが正常動作することを確認する。

**詳細**:
- Jenkins UIにアクセス
- 対象ジョブ: `AI_Workflow/ai_workflow_orchestrator`
- 確認項目:
  - ジョブ実行が成功すること
  - ログにエラーがないこと
  - V1への参照パスがログに出現しないこと
  - 正常終了すること
- エラー時のロールバック手順を準備

**該当Phase**: Phase 6 (Testing)

---

## 3. 非機能要件

### NFR-001: パフォーマンス要件

- **削除実行時間**: 5分以内
- **復元時間**: 5分以内（Issue #411で1秒未満を記録、十分な余裕）
- **Jenkins動作確認**: 10分以内

### NFR-002: セキュリティ要件

- **バックアップ保護**: バックアップブランチ `archive/ai-workflow-v1-python` を保護（誤削除防止）
- **コミット履歴**: 削除操作のGit履歴を永続的に保持
- **復元可能性**: バックアップブランチから1秒未満で復元可能（検証済み）

### NFR-003: 可用性・信頼性要件

- **冪等性**: 削除操作は複数回実行しても安全（既に削除済みの場合はエラー回避）
- **ロールバック可能性**: 問題発生時は即座にロールバック可能
  - コマンド: `git checkout archive/ai-workflow-v1-python -- scripts/ai-workflow/`
- **影響範囲の最小化**: V2への影響ゼロ（V1とV2は完全に独立）

### NFR-004: 保守性・拡張性要件

- **ドキュメント更新**: README.md変更履歴の更新（削除実行日、コミットハッシュ、Issue #415リンク）
- **復元手順の明記**: 将来的な復元が必要な場合に備えた手順書の整備
- **透明性**: 削除理由、バックアップ情報、テスト結果を明確に記録

---

## 4. 制約事項

### 技術的制約

1. **Git制約**
   - Git CLIを使用した操作に限定
   - GitHubへのプッシュ権限が必要
   - ブランチ作成・削除権限が必要

2. **既存コードとの整合性**
   - CLAUDE.md規約（line 348-360）準拠のコミットメッセージ
   - Co-Authorクレジット禁止（CLAUDE.md line 364）
   - V2への影響を完全に回避（V1への依存0件を維持）

3. **Jenkins環境制約（オプション）**
   - Jenkins UIへのアクセス権限
   - `AI_Workflow/ai_workflow_orchestrator` ジョブの実行権限

### リソース制約

1. **時間制約**
   - 総工数: 2.5~4.0時間
   - 完了目安: 1~2日以内

2. **人員制約**
   - 単一開発者で完結可能
   - コードレビュー不要（削除のみ）

3. **ツール制約**
   - 追加ツールのインストール不要
   - Git、GitHub CLI（gh）のみ使用

### ポリシー制約

1. **セキュリティポリシー**
   - バックアップブランチの保護（GitHub保護ブランチ設定推奨）
   - コミット履歴の永続的保持

2. **コーディング規約**
   - CLAUDE.md準拠（コミットメッセージ、Co-Authorクレジット禁止）
   - マークダウン形式のドキュメント（Issue報告、README更新）

---

## 5. 前提条件

### システム環境

- **OS**: Linux/macOS（Gitコマンドライン環境）
- **Git**: バージョン2.0以上
- **GitHub CLI (gh)**: Issue操作用（オプション）
- **Jenkins**: UIアクセス可能（動作確認用・オプション）

### 依存コンポーネント

1. **Issue #411の成果物**（すべて完了済み）
   - バックアップブランチ: `archive/ai-workflow-v1-python`
   - V1への参照削除（0件確認）
   - 12個の統合テスト実施（成功率100%）
   - Evaluation Report作成完了

2. **Gitリポジトリ**
   - リモートリポジトリ: `tielec/infrastructure-as-code`
   - ブランチ: 削除実行用の作業ブランチ（例: `task/issue-415-remove-v1`）
   - バックアップブランチ: `archive/ai-workflow-v1-python`（リモートに存在）

3. **ドキュメント**
   - CLAUDE.md（コミットメッセージ規約）
   - README.md（変更履歴セクション）
   - Issue #411のEvaluation Report

### 外部システム連携

- **GitHub**: Issue操作、コミット・プッシュ
- **Jenkins**: 動作確認（オプション）

---

## 6. 受け入れ基準

### AC-001: V1ディレクトリの削除実行

**Given**: バックアップブランチ `archive/ai-workflow-v1-python` が存在する
**When**: `git rm -rf scripts/ai-workflow/` を実行し、コミットを作成する
**Then**:
- `scripts/ai-workflow/` ディレクトリが存在しない
- `git status` で削除がステージングされている
- `git log` で削除コミットが記録されている
- コミットメッセージがCLAUDE.md規約に準拠している
- Co-Authorクレジットが含まれていない

### AC-002: バックアップブランチの存在確認

**Given**: Issue #411でバックアップブランチが作成済み
**When**: `git ls-remote --heads origin | grep archive/ai-workflow-v1-python` を実行
**Then**:
- バックアップブランチが存在する
- リモートリポジトリにプッシュされている

### AC-003: V1参照箇所の再確認

**Given**: Issue #411でV1への参照が完全削除済み（0件）
**When**: `grep -r "scripts/ai-workflow" --exclude-dir=.git --exclude-dir=ai-workflow` を実行
**Then**:
- 検索結果が0件である
- リンク切れが存在しない

### AC-004: コミットメッセージの準拠性

**Given**: CLAUDE.md規約（line 348-360）が定義されている
**When**: 削除コミットのメッセージを確認
**Then**:
- フォーマット: `[scripts] remove: 詳細な説明`
- 本文にバックアップ情報が含まれる
- 本文に復元手順が含まれる
- Co-Authorクレジットが含まれていない（CLAUDE.md line 364）

### AC-005: Issue #411への完了報告投稿

**Given**: 削除実行が完了している
**When**: Issue #411のコメント欄に報告を投稿
**Then**:
- 削除完了のサマリーが含まれる
- テスト結果の要約が含まれる（12/12成功）
- バックアップ情報が含まれる（ブランチ名、復元コマンド）
- 復元時間が記載される（5分以内）
- マークダウンフォーマットが適切である

### AC-006: Jenkins動作確認（オプション）

**Given**: Jenkins環境が稼働中である
**When**: `AI_Workflow/ai_workflow_orchestrator` ジョブを実行
**Then**:
- ジョブが正常終了する
- ログにエラーが存在しない
- ログにV1パス参照（`scripts/ai-workflow`）が存在しない

### AC-007: ドキュメント更新

**Given**: README.mdに変更履歴セクションが存在する
**When**: 削除実行後にREADME.mdを更新
**Then**:
- 削除実行日が記録されている
- コミットハッシュが記載されている
- Issue #415へのリンクが追加されている
- 復元手順が明記されている

### AC-008: 復元可能性の保証

**Given**: バックアップブランチが存在する
**When**: 復元コマンドを実行
**Then**:
- 復元時間が5分以内（Issue #411で1秒未満を記録）
- 復元後のディレクトリ構造が完全である
- 復元後のファイル内容が正確である

---

## 7. スコープ外

### 明確にスコープ外とする事項

1. **V2の改修・機能追加**
   - V2コードの変更は本Issueのスコープ外
   - V2は既に完成済みであり、変更不要

2. **ドキュメントの大幅変更**
   - README.mdの変更履歴セクション追記のみ
   - 全体的なドキュメント見直しは含まない

3. **新規テストコードの作成**
   - Issue #411の既存テストを再利用
   - 新規テストファイルの作成は不要

4. **GitHub保護ブランチ設定**
   - バックアップブランチの保護設定は推奨事項
   - 本Issueでの実施は任意（組織ポリシーに依存）

5. **Jenkins環境の構成変更**
   - Jenkins設定の変更は不要
   - 動作確認のみ実施（オプション）

### 将来的な拡張候補

1. **自動削除スクリプトの作成**
   - 非推奨コードの自動検出・削除ツール
   - 将来的な技術負債解消の自動化

2. **削除ワークフローの標準化**
   - 非推奨コード削除のテンプレート化
   - 他のプロジェクトへの適用

3. **バックアップブランチの保持期限設定**
   - 一定期間後の自動削除（例: 6ヶ月後）
   - ストレージコスト削減

---

## 8. 品質ゲート確認

本要件定義書は、Phase 1の品質ゲートを満たしています：

- ✅ **機能要件が明確に記載されている**: FR-001~004で4つの機能要件を定義
- ✅ **受け入れ基準が定義されている**: AC-001~008で8つの受け入れ基準をGiven-When-Then形式で記述
- ✅ **スコープが明確である**: スコープ外の5項目を明示し、将来拡張候補を提示
- ✅ **論理的な矛盾がない**: 各セクション間で整合性を確保（Planning Documentとの整合性含む）

---

## 9. 補足情報

### Issue #411との関係

本Issueは、Issue #411（AI Workflow V1からV2への移行）のフォローアップです：

- **Issue #411の範囲**: 準備作業（DEPRECATED化、バックアップ、参照削除、テスト）
- **Issue #415の範囲**: 最終仕上げ（物理削除、報告、動作確認）

### 成功基準（Success Criteria）

Planning Documentで定義された6つの成功基準をすべて満たすことで完了：

1. ✅ **削除完了**: `scripts/ai-workflow/` が完全削除
2. ✅ **バックアップ確保**: `archive/ai-workflow-v1-python` が存在し復元可能
3. ✅ **ドキュメント更新**: 削除完了が適切に記録
4. ✅ **テスト成功**: すべての統合テストが成功
5. ✅ **完了報告**: Issue #411に報告投稿
6. ✅ **安全性確保**: 即座に復元できる手順を確立

---

**要件定義書バージョン**: v1.0
**作成日**: 2025年
**最終更新日**: 2025年
