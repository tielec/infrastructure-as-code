# テストコード実装フェーズ - 実行プロンプト

## タスク概要
Phase 3のテストシナリオとPhase 4の実装に基づいて、テストコードを実装してください。

**🚨 最重要タスク: 実際のテストファイルの作成が最優先です**
- テスト実装ログ（test-implementation.md）だけでなく、**実際に実行可能なテストファイル**を必ず作成してください
- テストファイルを作成せずにログだけ書いても、Phase 6でテストが実行できず失敗します
- テストファイルの配置場所: プロジェクト構造に応じた適切なテストディレクトリ
- 対応言語: Python (.py), JavaScript (.test.js), TypeScript (.test.ts), Go (_test.go), Java (Test*.java) など
- 例: `tests/unit/test_xxx.py`、`src/tests/test_xxx.py`、`scripts/ai-workflow/tests/test_xxx.py` など

## ⚠️ このフェーズが不要と判断した場合の対応（Issue #411）

**重要**: このIssueでテストコード実装が不要と判断した場合でも、**必ずtest-implementation.mdファイルを作成**してください。
ファイルが作成されないと、ワークフローがエラーで停止します。

### スキップ判断の基準
以下のような場合、テストコード実装をスキップすることが適切です：
- ドキュメント修正のみのIssue
- ファイル削除のみのIssue
- 設定ファイルの微修正のみのIssue
- テスト対象となる実装コードが存在しないIssue

### スキップ時のファイル作成（必須）
スキップすると判断した場合、以下のテンプレートで必ずtest-implementation.mdを作成してください：

```markdown
# テストコード実装

## スキップ判定
このIssueではテストコード実装が不要と判断しました。

## 判定理由
- （具体的な理由を箇条書きで記載）
- 例: ドキュメント修正のみのため、テスト対象コードが存在しない
- 例: ファイル削除のみのため、新規テストコードは不要

## 次フェーズへの推奨
Phase 6（Testing）もスキップを推奨します。
```

**注意**: このテンプレートでファイルを作成した場合、Phase 6（Testing）でも同様にスキップ判定される可能性があります。

## 入力情報

### Planning Phase成果物
- Planning Document: {planning_document_path}

**注意**: Planning Phaseが実行されている場合、開発計画（実装戦略、テスト戦略、リスク、スケジュール）を必ず確認してください。

### テストシナリオ（利用可能な場合）
{test_scenario_context}
<!--
  存在する場合: @test-scenario.md への参照
  存在しない場合: "テストシナリオは利用できません。実装時に適切なテスト考慮を行ってください。"
-->

### 実装ログ（利用可能な場合）
{implementation_context}
<!--
  存在する場合: @implementation.md への参照
  存在しない場合: "実装ログは利用できません。設計書とテストシナリオに基づいて実装してください。"
-->

### 設計書（利用可能な場合）
{design_context}
<!--
  存在する場合: @design.md への参照
  存在しない場合: "設計書は利用できません。Issue情報とPlanning情報に基づいて適切な設計判断を行ってください。"
-->

### 要件定義書（利用可能な場合）
{requirements_context}
<!--
  存在する場合: @requirements.md への参照
  存在しない場合: "要件定義書は利用できません。Planning情報とIssue情報から要件を推測してください。"
-->

### テスト戦略（Phase 2で決定）
**{test_strategy}**

## テスト戦略別の対応

Phase 2で決定されたテスト戦略に応じて、適切なテストコードを実装してください：

### UNIT_ONLY
- 各関数・メソッドの単体テストのみ実装
- モック・スタブを活用して外部依存を排除

### INTEGRATION_ONLY
- コンポーネント間の統合テストのみ実装
- 実際のDBやAPIを使用したテスト

### UNIT_INTEGRATION
- ユニットテストと統合テストの両方を実装
- ユニットテスト: 関数・メソッドレベル
- 統合テスト: コンポーネント間の連携

### BDD
- Given-When-Then形式のBDDテストを実装
- ユーザーストーリーに基づくシナリオテスト

### ALL（UNIT + INTEGRATION + BDD）
- すべてのテストタイプを実装
- 包括的なテストカバレッジを確保

## テストコード実装手順

### 1. テストシナリオの確認

Phase 3で作成されたテストシナリオを確認してください：
- 正常系シナリオ
- 異常系シナリオ
- エッジケースシナリオ

### 2. 実装コードの理解

Phase 4で実装された実コードを確認してください：
- 実装されたクラス・関数
- インターフェース
- データ構造

### 3. テストコードの実装

テストシナリオに基づいて、以下を実装してください：

#### 3.1 テストファイル作成（最優先タスク）
- 命名規則（言語により異なる）:
  - Python: test_*.py, *_test.py
  - JavaScript/TypeScript: *.test.js, *.spec.js, *.test.ts, *.spec.ts
  - Go: *_test.go
  - Java: Test*.java, *Test.java
  - Shell: test_*.sh
- 配置場所: プロジェクト構造に応じた適切なテストディレクトリ
- テスト戦略に応じた適切なディレクトリ構造（例: tests/unit/、tests/integration/等）
- **注意**: プロジェクトの既存のテストディレクトリ構造を確認し、それに合わせて配置してください

#### 3.2 テストケース実装
- Given-When-Then構造でテストを記述
- アサーション（assert文）を明確に
- テストの意図をコメントで記載

#### 3.3 テストユーティリティ
- モック・スタブの実装
- テストフィクスチャの作成
- テストヘルパー関数

### 4. テスト実装ログの記録

実装した内容を以下の形式で記録してください：

```markdown
# テストコード実装ログ

## 実装サマリー
- テスト戦略: {test_strategy}
- テストファイル数: X個
- テストケース数: Y個

## テストファイル一覧

### 新規作成
- `tests/test_xxx.py`: （説明）

## テストケース詳細

### ファイル: tests/test_xxx.py
- **test_function1**: （テスト内容）
- **test_function2**: （テスト内容）

## 次のステップ
- Phase 6でテストを実行
```

このログを `.ai-workflow/issue-{issue_number}/05_test_implementation/output/test-implementation.md` として保存してください。

## 品質ゲート（Phase 5）

テストコード実装は以下の品質ゲートを満たす必要があります：

- [ ] **Phase 3のテストシナリオがすべて実装されている**
- [ ] **テストコードが実行可能である**
- [ ] **テストの意図がコメントで明確**

これらの品質ゲートは**必須要件**です。実装後、クリティカルシンキングレビューが実施され、品質ゲートを満たさない場合は修正が必要になります。

## 注意事項

1. **責務の明確化**: テストコードのみを実装
   - 実コードは Phase 4 で実装済み
   - Phase 5 では一切の実コード変更を行わない

2. **テストの独立性**: テスト間の依存関係を避ける
   - 各テストは独立して実行可能
   - テストの実行順序に依存しない

3. **テストカバレッジ**: 十分なカバレッジを確保
   - 主要な機能はすべてテスト
   - エッジケースも考慮

4. **レビューされることを意識**: テストコードはクリティカルシンキングレビューが実施されます
   - 品質ゲート（3つの必須要件）を最優先で満たすこと
   - テストの意図を明確に

## テストコード実装開始

上記を踏まえ、テストコードを実装し、実装ログを作成してください。
