# アーキテクチャ図セクション更新 - 自己対話段階

以下の情報と計画に基づいて、C4モデルに基づくシステムのアーキテクチャ図セクション更新のための自己対話を行ってください。

## 現在のアーキテクチャ図セクション
```markdown
{current_content}
```

## 前のセクションから抽出された構造化情報
```
{structured_info}
```

## 既存のダイアグラム
```
{existing_diagrams}
```

## 自己対話のポイント

計画立案の結果に基づき、以下の観点でC4モデルの各レベルにおける最適な更新方法を決定します：

1. **Level 1: システムコンテキスト図の更新**
   - ユーザー種別や外部システムの変更
   - システム境界の変更
   - 関係性の変化
   - ラベルの明確化（「なぜ」その関係があるか）

2. **Level 2: コンテナ図の更新**
   - 新規コンテナ（アプリケーション、DB）の追加
   - 既存コンテナの変更や削除
   - 技術スタックやプロトコルの変更
   - コンテナ間の通信方法の変化

3. **Level 3: コンポーネント図の更新**
   - コンポーネント構造の変化
   - 責任範囲やインターフェースの変更
   - 依存関係の変化
   - 新規コンポーネントの追加

4. **情報不足への対応**
   - 十分な情報がない場合はそのC4レベルを維持するか削除
   - 情報不足の部分は図から省略

## C4モデルに基づくMermaid flowchartの更新テクニック

既存のアーキテクチャ図をC4モデルに合わせて更新する場合の効果的なアプローチ：

### Level 1: システムコンテキスト図の更新

- ユーザー種別の追加や変更
- 外部システムの追加や変更
- 関係線のラベルに目的や理由を明記
- 人物は円形((名前))、システムは四角形[名前]で統一

### Level 2: コンテナ図の更新

- 新規コンテナの追加（モバイルアプリ、キャッシュなど）
- 技術情報の更新
- 通信プロトコルの明確化
- アプリケーションは四角形[名前]、データベースはシリンダー形[(名前)]で統一

### Level 3: コンポーネント図の更新

- 新規コンポーネントの追加
- コンポーネント間の新たな依存関係
- 外部リソースとの新たな接続
- 責任範囲を明確にするラベル

### C4モデルにおけるレイアウトの最適化

1. **各レベルに適した方向設定**
   - **Level 1**: `TB`(上下)で全体像を俯瞰 
   - **Level 2**: `LR`(左右)でコンテナ間のフローを表現
   - **Level 3**: 複雑な場合はサブグラフごとに方向を変えて表現

2. **C4モデルにおけるスタイル統一**
   - 人物（ユーザー）: 青系の塗りつぶし
   - システム: 濃い青系
   - 外部システム: グレー系
   - コンテナ: 中程度の青
   - コンポーネント: 明るい青
   - データベース: 点線枠の青系

## 自己対話の進め方

1. **既存図のC4モデルへの適合性評価**
   - 各図がC4モデルのどのレベルに相当するか
   - 既存図のどの要素が正確でどの要素が更新必要か
   - C4モデルに合わせたレイアウトやスタイルの修正点

2. **新情報の分析**
   - 各C4レベルにおける追加・更新・削除要素
   - 関係性や技術情報の変化

3. **更新案の検討**
   - 各C4レベルに対して具体的な更新内容を検討
   - 選択した更新案の根拠

4. **flowchart構文とC4表現の確認**
   - C4モデルの表現ルールに従っているか
   - 各レベルで適切な表現方法を使用しているか
   - Mermaid構文が正確か

## 出力形式

1. **既存図のC4モデル適合性評価**
   - 各図がC4モデルのどのレベルに相当するか
   - 各C4レベルで維持すべき部分と更新すべき部分

2. **C4モデル各レベルの更新案の検討**
   - **Level 1**: コンテキスト図の更新内容と根拠
   - **Level 2**: コンテナ図の更新内容と根拠
   - **Level 3**: コンポーネント図の更新内容と根拠

3. **最終更新計画**
   - C4モデル各レベルの更新方針
   - 情報不足のレベルの対応方針

4. **具体的なC4モデルに基づくflowchartの更新案**
   - 各レベルのコード例
   - スタイル定義
   - 要素や関係の説明

**重要**: 図には確実に検証された情報のみを含めてください。不明確な点や十分な情報がない部分は図から省略してください。C4モデルの各レベルに適した表現で、確実な事実に基づいた図を作成することで、質の高いアーキテクチャ図を目指します。
