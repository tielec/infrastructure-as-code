# Jenkins フォルダ構造設定ファイル

# フォルダ定義（フラット構造）
folders:
  # 管理者用ジョブフォルダ
  - path: "Admin_Jobs"
    displayName: "01. [Admin] 管理ジョブ"
    description: |
      このフォルダーには、管理者用のジョブが含まれています。
      
      ### 概要
      Jenkins環境の管理・保守に必要な各種ジョブを集約しています。
      設定のバックアップ/リストア、GitHub連携の設定、ユーザー管理、
      システムテストなどの管理タスクを実行できます。
      
      ### 注意事項
      * 一部のジョブはmasterノードでの実行が必要です
      * 管理者権限が必要なジョブが含まれています
      * 実行前に各ジョブの説明を確認してください

  # アカウントセットアップフォルダ
  - path: "Account_Setup"
    displayName: "02. [Admin] アカウントセットアップ"
    description: |
      このフォルダーには、アカウントセットアップを行うジョブが含まれています。
      
      ### 概要
      * 新規ユーザーのアカウントセットアップを自動化するジョブを管理

  # プレイグラウンドフォルダ
  - path: "Playgrounds"
    displayName: "90. [Sandbox] プレイグラウンド"
    description: |
      このフォルダーは、ユーザーが自由にジョブの作成と検証を行うための場所です。
      
      ### 目的
      * 各ユーザーが独自のジョブを作成し、安全に検証できる環境を提供
      * CI/CDパイプラインの実験や新機能のテストに活用
      
      ### 使用方法
      1. このフォルダ内に自分の名前でサブフォルダを作成してください  
         例: Playgrounds/yamada/
      2. 作成したフォルダ内で自由にジョブを作成・検証できます
      
      ### 注意事項
      * 他のユーザーのフォルダには変更を加えないでください
      * リソースの過剰な使用は避けてください
      * 本番環境に影響を与える可能性のある操作は行わないでください
      * 定期的に不要なジョブやフォルダの清掃を行ってください
      
      不明点がある場合は管理者に確認してください。

  # コード品質チェッカーフォルダ
  - path: "Code_Quality_Checker"
    displayName: "30. [Quality] コード品質チェック"
    description: |
      このフォルダーには、コード品質チェックを行うジョブが含まれています。
      
      ### 概要
      各プロジェクトのソースコードの品質を自動的に分析・評価します。
      循環的複雑度（Cyclomatic Complexity）の測定など、コード品質の向上と技術的負債の
      管理に必要なジョブを集約しています。
      
      ### 主な機能
      * **循環的複雑度分析** - 関数の複雑さを数値化し、リファクタリング対象を特定
      
      ### メトリクスの解釈
      * **複雑度 1-10**: シンプルで理解しやすい（推奨）
      * **複雑度 11-15**: やや複雑（要注意）
      * **複雑度 16以上**: 複雑でリスクが高い（リファクタリング推奨）
      
      ### 実行方法
      * 定期実行: 毎週月曜日の朝9時に自動実行
      * 手動実行: 各ジョブの「Build with Parameters」から実行

  # ドキュメント生成フォルダ
  - path: "Document_Generator"
    displayName: "31. [Quality] ドキュメント生成"
    description: |
      このフォルダーには、ドキュメント自動生成を行うジョブが含まれています。
      
      ### 概要
      各プロジェクトのソースコードから技術ドキュメントを自動生成します。
      Doxygenによるコード解析、コメント自動挿入、プルリクエストへの
      ドキュメントフィードバックなど、開発ドキュメントの品質向上と
      保守性を高めるためのジョブを管理しています。
      
      ### 構成
      * プロジェクトごとにサブフォルダで管理
      * GitHub連携による自動実行とマニュアル実行の両方に対応
      * Doxygen、技術文書生成、PRコメント機能を提供

  # デリバリー管理ジョブフォルダ
  - path: "delivery-management-jobs"
    displayName: "10. [Deploy] デリバリー管理"
    description: |
      このフォルダーには、インフラストラクチャとアプリケーションの
      デリバリー（配信・展開）を管理するジョブが含まれています。
      
      ### 概要
      CI/CDパイプラインの最終段階として、各種サービスやインフラの
      本番環境・開発環境へのデプロイメントを統括管理します。
      
      ### 構成
      * common: 両環境共通のジョブ
      * development: 開発環境向けデリバリー
      * production: 本番環境向けデリバリー
      
      ### 対象
      * インフラストラクチャ（Pulumi等）
      * アプリケーション（各種サービス）
      * 設定・構成管理（Ansible等）
      
      ### 注意事項
      * 環境別に権限が設定されています
      * 本番環境へのデリバリーは承認プロセスが必要です

  # 共通環境フォルダ
  - path: "delivery-management-jobs/common"
    displayName: "Common"
    description: |
      両環境共通のジョブ
      
      ### 概要
      開発・本番両環境で使用可能な共通ジョブ
      
      ### 対象
      * Bootstrap設定
      * Jenkins環境管理
      * 基盤インフラストラクチャ

  # 共通環境Pulumiデプロイメント
  - path: "delivery-management-jobs/common/pulumi-deployments"
    displayName: "Pulumi Deployments"
    description: |
      共通環境のPulumiインフラストラクチャデプロイメント
      
      ### 含まれるジョブ
      * Jenkins関連インフラストラクチャ（ネットワーク、セキュリティ、ストレージ等）
      * 共通基盤インフラストラクチャ
      
      Infrastructure as Codeによる環境構築・更新を管理

  # 共通環境Ansibleデプロイメント
  - path: "delivery-management-jobs/common/ansible-deployments"
    displayName: "Ansible Deployments"
    description: |
      共通環境のAnsibleプレイブック実行
      
      ### 含まれるジョブ
      * Bootstrap設定
      * Jenkins環境のデプロイ・削除
      * Jenkinsメンテナンスタスク
      
      Configuration as Codeによる環境構成・管理

  # 開発環境デリバリーフォルダ
  - path: "delivery-management-jobs/development"
    displayName: "Development"
    description: |
      開発環境向けのデリバリージョブ
      
      ### 実行権限
      開発チームメンバーが実行可能
      
      ### 特徴
      * 迅速なフィードバックサイクル
      * 実験的な変更の検証が可能

  # 開発環境Pulumiデプロイメント
  - path: "delivery-management-jobs/development/pulumi-deployments"
    displayName: "Pulumi Deployments"
    description: |
      開発環境のPulumiインフラストラクチャデプロイメント
      
      Infrastructure as Codeによる環境構築・更新を管理

  # 開発環境Ansibleデプロイメント
  - path: "delivery-management-jobs/development/ansible-deployments"
    displayName: "Ansible Deployments"
    description: |
      開発環境のAnsibleプレイブック実行
      
      ### 含まれるジョブ
      * Lambda関数管理（IPホワイトリスト、セットアップ/削除）
      * テストプレイブック（AWS CLI、S3、SSMパラメータストア）
      
      Configuration as Codeによる環境構成・管理を実施

  # 本番環境デリバリーフォルダ
  - path: "delivery-management-jobs/production"
    displayName: "Production"
    description: |
      本番環境向けのデリバリージョブ
      
      ### 実行権限
      本番デプロイ権限を持つメンバーのみ実行可能
      
      ### プロセス
      * すべてのデリバリーに承認が必要
      * 変更内容の事前レビュー必須
      * ロールバック手順の確認必須
      
      ### 注意事項
      * 実行前に必ず影響範囲を確認
      * 関係者への通知を忘れずに

  # 本番環境Pulumiデプロイメント
  - path: "delivery-management-jobs/production/pulumi-deployments"
    displayName: "Pulumi Deployments"
    description: |
      本番環境のPulumiインフラストラクチャデプロイメント
      
      本番環境の安定性を保ちながら、計画的な更新を実施

  # 本番環境Ansibleデプロイメント
  - path: "delivery-management-jobs/production/ansible-deployments"
    displayName: "Ansible Deployments"
    description: |
      本番環境のAnsibleプレイブック実行
      
      ⚠️ **注意**: 本番環境の変更は慎重に行ってください
      
      ### 含まれるジョブ
      * Lambda関数管理（IPホワイトリスト、セットアップ/削除）
      
      ### 注意事項
      * 本番環境のLambda関数に影響します
      * 実行前に開発環境でテストすることを推奨
      
      Configuration as Codeによる本番環境の構成管理

  # 共有ライブラリフォルダ
  - path: "Shared_Library"
    displayName: "40. [Test] 共有ライブラリテスト"
    description: |
      このフォルダーには、共有ライブラリのテストやサンプルジョブが含まれています。
      
      ### 概要
      * 共有ライブラリの機能をテストするためのジョブを管理
      * 共有ライブラリの使用例を示すサンプルジョブを管理

  # 共有ライブラリ - AWSユーティリティ
  - path: "Shared_Library/AWS_Utils"
    displayName: "AWS Utilities Tests & Examples"
    description: |
      このフォルダーには、AWSユーティリティのテストジョブが含まれています。
      
      ### 概要
      * AWSの操作をテストするジョブを管理

  # 共有ライブラリ - Jenkins CLIユーティリティ
  - path: "Shared_Library/Jenkins_Cli_Utils"
    displayName: "Jenkins CLI Utilities Tests & Examples"
    description: |
      このフォルダーには、Jenkins CLIユーティリティのテストジョブが含まれています。
      
      ### 概要
      * Jenkins CLIを使用した操作をテストするジョブを管理
      * Jenkins CLIの機能を検証するためのサンプルジョブを管理

  # 共有ライブラリ - Gitユーティリティ
  - path: "Shared_Library/Git_Utils"
    displayName: "Git Utilities Tests & Examples"
    description: |
      このフォルダーには、Gitユーティリティのテストジョブが含まれています。
      
      ### 概要
      * Gitの操作をテストするジョブを管理

  # パイプラインテストフォルダ
  - path: "Pipeline_Tests"
    displayName: "41. [Test] パイプラインテスト"
    description: |
      このフォルダーには、パイプラインのテストジョブが含まれています。
      
      ### 概要
      * パイプラインの機能をテストするためのジョブを管理
      * パイプラインスクリプトの検証やデバッグに使用

  # パイプラインテスト - ドキュメント生成
  - path: "Pipeline_Tests/Document_Generator"
    displayName: "Document Generator Tests"
    description: |
      このフォルダーには、ドキュメント自動生成パイプラインのテストジョブが含まれています。
      
      ### 概要
      * ドキュメント自動生成パイプラインの機能をテストするためのジョブを管理
      * パイプラインスクリプトの検証やデバッグに使用

  # パイプラインテスト - インフラストラクチャ
  - path: "Pipeline_Tests/Infrastructure"
    displayName: "Infrastructure Tests"
    description: |
      このフォルダーには、インフラストラクチャ関連のパイプラインテストジョブが含まれています。
      
      ### 概要
      * Pulumi、Terraform等のIaCツールのパイプラインテスト
      * インフラストラクチャのデプロイメント・管理パイプラインの検証

  # インフラストラクチャー管理フォルダ
  - path: "Infrastructure_Management"
    displayName: "20. [Ops] インフラ運用管理"
    description: |
      このフォルダーには、インフラストラクチャーの管理ジョブが含まれています。

      ### 概要
      Jenkins、Lambda、その他AWSリソースなど、プロジェクト全体のインフラストラクチャー管理タスクを実行します。
      環境の起動、停止、スケーリング、メンテナンス、コスト最適化などの操作を管理します。

      ### 主な機能
      * **Jenkins環境停止** - Jenkins環境（Controller、Agent）を安全に停止
      * **Lambda NAT削除** - Lambda NAT Instanceの夜間自動削除
      * **環境起動** - 各種環境を起動
      * **スケーリング** - エージェントのスケール調整
      * **コスト最適化** - 不要リソースの自動削除によるコスト削減

      ### 注意事項
      * これらのジョブはインフラストラクチャー全体に影響を与える可能性があります
      * 実行前に他のジョブの実行状況を確認してください
      * 管理者権限が必要な操作が含まれています

  # AI駆動開発フォルダ
  - path: "AI_Workflow"
    displayName: "50. [AI] AI駆動開発"
    description: |
      このフォルダーには、AI駆動開発自動化ワークフローのジョブが含まれています。

      ### 概要
      GitHub IssueからPR作成まで、Claude AIが自動的に開発プロセスを実行します。
      実行モードごとにジョブが分割され、リポジトリ別に整理されています。

      ### ジョブ構成
      各リポジトリ配下に以下のジョブが配置されます：
      * **all_phases** - 全フェーズ一括実行（planning → evaluation）
      * **preset** - プリセット実行（quick-fix, implementation等）
      * **single_phase** - 単一フェーズ実行
      * **rollback** - フェーズ差し戻し実行
      * **auto_issue** - AIによる自動Issue作成

      ### パラメータ削減効果
      実行モードごとの分割により、パラメータ数を24個 → 8〜15個に削減しました。

      ### 主な機能
      * **自動要件定義** - GitHub Issueから要件定義書を生成
      * **自動設計** - 詳細設計書とアーキテクチャドキュメントを生成
      * **自動テストシナリオ** - BDD形式のテストシナリオを生成
      * **自動実装** - コードの自動生成と既存コードの拡張
      * **自動テスト** - テストの実行と結果検証
      * **自動ドキュメント** - README、APIドキュメントを生成

      ### 必要な認証情報
      * **claude-api-key**: Claude API キー（Jenkinsクレデンシャル）
      * **github-token**: GitHub Token（Jenkinsクレデンシャル）

  # Issue #456: AI Workflow用の汎用フォルダを追加
  # 追加日: 2025-01-17
  # URL: https://github.com/tielec/infrastructure-as-code/issues/456
  #
  # 背景:
  # - 特定リポジトリに依存しない汎用的なワークフロー実行環境が必要
  # - developブランチ用（最新機能のテスト）とmainブランチ用（安定バージョン）を分離
  # - main用は並行利用可能にするため2つ用意

  # AI Workflow - develop用汎用フォルダ
  - path: "AI_Workflow/develop-generic"
    displayName: "汎用 - Develop"
    description: |
      developブランチ用の汎用ワークフロー実行環境

      ### 用途
      - ai-workflow-agentの**最新バージョン**（developブランチ）を使用
      - 新機能のテスト、実験的な利用
      - 特定リポジトリに依存しない汎用的なワークフロー

      ### 対象ブランチ
      - ai-workflow-agent: **develop**

      ### 推奨の使い方
      - 最新機能の検証
      - 新しいワークフローのテスト
      - リポジトリ横断的なタスク実行

      ### 注意事項
      - 開発中の機能のため、動作が不安定な場合があります
      - 本番環境での利用は避けてください
      - 安定した動作が必要な場合はmain用フォルダを使用してください

  # AI Workflow - main用汎用フォルダ（1つ目）
  - path: "AI_Workflow/main-generic-1"
    displayName: "汎用 - Main #1"
    description: |
      mainブランチ用の汎用ワークフロー実行環境（1つ目）

      ### 用途
      - ai-workflow-agentの**安定バージョン**（mainブランチ）を使用
      - 本番環境での利用、安定した動作が求められる場合
      - 特定リポジトリに依存しない汎用的なワークフロー

      ### 対象ブランチ
      - ai-workflow-agent: **main**

      ### 推奨の使い方
      - 本番環境でのワークフロー実行
      - 安定性が求められるタスク
      - リポジトリ横断的なタスク実行

      ### 並行利用について
      - main用フォルダは2つあり、複数のワークフローを同時実行可能です
      - 使用中は`main-generic-2`をご利用ください

  # AI Workflow - main用汎用フォルダ（2つ目）
  - path: "AI_Workflow/main-generic-2"
    displayName: "汎用 - Main #2"
    description: |
      mainブランチ用の汎用ワークフロー実行環境（2つ目）

      ### 用途
      - ai-workflow-agentの**安定バージョン**（mainブランチ）を使用
      - 本番環境での利用、安定した動作が求められる場合
      - 特定リポジトリに依存しない汎用的なワークフロー

      ### 対象ブランチ
      - ai-workflow-agent: **main**

      ### 推奨の使い方
      - 本番環境でのワークフロー実行
      - 安定性が求められるタスク
      - リポジトリ横断的なタスク実行

      ### 並行利用について
      - main用フォルダは2つあり、複数のワークフローを同時実行可能です
      - `main-generic-1`が使用中の場合はこちらをご利用ください

# 動的フォルダ生成ルール
dynamic_folders:
  # AI Workflowのリポジトリ別フォルダ
  - parent_path: "AI_Workflow"
    source: "jenkins-managed-repositories"
    template:
      path_suffix: "{name}"
      displayName: "AI Workflow - {name}"
      description: |
        {name}リポジトリのAI駆動開発ワークフロージョブ

        ### 提供ジョブ
        * **all_phases** - 全フェーズ一括実行（14パラメータ）
        * **preset** - プリセット実行（15パラメータ）
        * **single_phase** - 単一フェーズ実行（13パラメータ）
        * **rollback** - フェーズ差し戻し実行（12パラメータ）
        * **auto_issue** - 自動Issue作成（8パラメータ）

        ### 実行モード
        各ジョブは実行モードが固定されており、必要なパラメータのみを表示します。

        ### 推奨の使い方
        1. **通常の開発**: `preset` → `implementation`を選択
        2. **軽微な修正**: `preset` → `quick-fix`を選択
        3. **テストのみ追加**: `preset` → `testing`を選択
        4. **特定フェーズのみ**: `single_phase`でフェーズを指定
        5. **レビュー修正**: `rollback`で差し戻し先を指定
        6. **Issue探索**: `auto_issue`でバグや改善点を検出

  # Code Quality Checkerのリポジトリ別フォルダ
  - parent_path: "Code_Quality_Checker"
    source: "jenkins-managed-repositories"
    template:
      path_suffix: "{name}"
      displayName: "Code Quality - {name}"
      description: |
        {name}リポジトリのコード品質チェックジョブ
        
        ### 提供機能
        * **循環的複雑度分析** - 複雑度の測定とレポート生成
        * **閾値チェック** - 設定した閾値を超える関数の自動検出
        * **HTMLレポート** - 視覚的に分かりやすい分析結果の表示
        
        ### レポート内容
        * 全関数の複雑度一覧（上位300件）
        * 統計情報（総関数数、平均複雑度、最大複雑度など）
        * 問題のある関数のハイライト（色分け表示）
        
        ### カスタマイズ可能な閾値
        * **複雑度閾値**: デフォルト15（変更可能）
        * **最小コード行数**: デフォルト100行
        
        ### 除外設定
        テストコード、ビルド成果物、外部ライブラリなどを自動的に除外

  # Document Generatorのリポジトリ別フォルダ
  - parent_path: "Document_Generator"
    source: "jenkins-managed-repositories"
    template:
      path_suffix: "{name}"
      displayName: "Document Generator - {name}"
      description: |
        {name}リポジトリのドキュメント自動生成ジョブ
        
        ### 提供機能
        * **Doxygenコメント自動挿入** - ソースコードにDoxygenコメントを自動追加
        * **Doxygen HTML生成** - コードからHTML形式のAPIドキュメントを生成
        * **PRコメント機能** - プルリクエストにドキュメント関連のフィードバックを投稿
        * **技術文書生成** - プロジェクトの技術文書を自動作成
        
        ### 実行方法
        * GitHub Webhookによる自動実行（*_github_triggerジョブ）
        * 手動実行による個別処理